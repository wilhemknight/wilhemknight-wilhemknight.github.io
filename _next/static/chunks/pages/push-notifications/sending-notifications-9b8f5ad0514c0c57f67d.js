_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[199],{"+Css":function(e,t,n){"use strict";function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return i}))},"+p6c":function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return l})),n.d(t,"headings",(function(){return p})),n.d(t,"default",(function(){return b}));var i=n("HALo"),o=n("dhJC"),a=(n("q1tI"),n("7ljp")),r=n("KiYJ"),s=n("3WCi"),c=["components"],l={title:"Sending Notifications with Expo's Push API",sidebar_title:"Sending Notifications with Expo's Push API"},p=[{depth:2,type:"text",title:"Implementing push notifications reliably"},{depth:3,type:"text",title:"Limit concurrent connections"},{depth:3,type:"text",title:"Retry on failure"},{depth:3,type:"text",title:"Check push receipts for errors"},{depth:3,type:"text",title:"SLAs"},{depth:2,type:"text",title:"HTTP/2 API"},{depth:3,type:"text",title:"Push tickets"},{depth:3,type:"text",title:"Push receipts"},{depth:2,type:"text",title:"Errors"},{depth:3,type:"text",title:"Individual errors"},{depth:3,type:"text",title:"Push ticket errors"},{depth:3,type:"text",title:"Push receipt errors"},{depth:3,type:"text",title:"Request errors"},{depth:2,type:"text",title:"Additional Security"},{depth:2,type:"text",title:"Formats"},{depth:3,type:"text",title:"Message request format"},{depth:3,type:"text",title:"Push ticket format"},{depth:3,type:"text",title:"Push receipt request format"},{depth:3,type:"text",title:"Push receipt response format"},{depth:2,type:"text",title:"Delivery Guarantees"},{depth:2,type:"text",title:"Next steps"},{depth:2,type:"text",title:"See also"}],u={meta:l,headings:p};function b(e){var t=e.components,n=Object(o.a)(e,c);return Object(a.b)("wrapper",Object(i.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"If you're just getting started and want to focus on the front-end for now, you can skip this step and just use ",Object(a.b)("a",{parentName:"p",href:"https://expo.dev/notifications"},"Expo's push notification tool")," to send notifications with the click of a button.")),Object(a.b)("p",null,"Along with the ",Object(a.b)("a",{parentName:"p",href:"/versions/latest/sdk/notifications/"},Object(a.b)("inlineCode",{parentName:"a"},"expo-notifications"))," module, which provides all the client-side functionality for push notifications, Expo can also handle sending these notifications off to APNs and FCM for you! All you need to do is send the request to our servers with the ExpoPushToken you grabbed in the last step."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"If you'd rather build a server that communicates with APNs and FCM directly, check out ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications-custom/"},"this guide")," (this is more complicated than using Expo's push notification service).")),Object(a.b)(r.a,{alt:"Diagram explaining sending a push from your server to device",src:"/static/images/sending-notification.png",containerStyle:{backgroundColor:"#fff"},mdxType:"ImageSpotlight"}),Object(a.b)("p",null,"When you're ready to send a push notification, take the Expo push token from your user record and send it to the Expo API using a plain old HTTPS POST request. You'll probably do this from your server (you could write a command line tool to send them if you wanted, or send them straight from your app, it's all the same), and the Expo team and community have taken care of wrapping that for you in a few languages:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/expo/expo-server-sdk-node"},"expo-server-sdk-node")," for Node.js. Maintained by the Expo team."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/expo/expo-server-sdk-python"},"expo-server-sdk-python")," for Python. Maintained by community developers."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/expo/expo-server-sdk-ruby"},"expo-server-sdk-ruby")," for Ruby. Maintained by community developers."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/expo/expo-server-sdk-rust"},"expo-server-sdk-rust")," for Rust. Maintained by community developers."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/solvecrew/ExpoNotificationsBundle"},"ExpoNotificationsBundle")," for Symfony. Maintained by SolveCrew."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/Alymosul/exponent-server-sdk-php"},"exponent-server-sdk-php")," or ",Object(a.b)("a",{parentName:"li",href:"https://github.com/ctwillie/expo-server-sdk-php"},"expo-server-sdk-php")," for PHP. Maintained by community developers."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/oliveroneill/exponent-server-sdk-golang"},"exponent-server-sdk-golang")," for Golang. Maintained by community developers."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/rdrop/exponent-server-sdk-elixir"},"exponent-server-sdk-elixir")," for Elixir. Maintained by community developers."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/glyphard/expo-server-sdk-dotnet"},"expo-server-sdk-dotnet")," for dotnet. Maintained by community developers."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://github.com/jav/expo-server-sdk-java"},"expo-server-sdk-java")," for Java. Maintained by community developers.")),Object(a.b)("p",null,"Check out the source if you would like to implement it in another language."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},Object(a.b)("strong",{parentName:"p"},"Note:")),Object(a.b)("p",{parentName:"blockquote"},"If you're ",Object(a.b)("strong",{parentName:"p"},"not")," testing in the Expo Go app, make sure you've ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/push-notifications-setup/#credentials"},"generated the proper push credentials")," before proceeding! If you haven't, push notifications will not work.")),Object(a.b)("h2",{id:"implementing-push-notifications-reliably"},"Implementing push notifications reliably"),Object(a.b)("p",null,"Push notifications travel through several systems from your server to recipient devices. Notifications are delivered most of the the time but occasionally there are issues with systems along the way and the network connections between them. Handling outages and errors will help your push notifications arrive at their destinations more reliably."),Object(a.b)("h3",{id:"limit-concurrent-connections"},"Limit concurrent connections"),Object(a.b)("p",null,"When sending a large number of push notifications at once, limit the number of your concurrent connections. The ",Object(a.b)("a",{parentName:"p",href:"https://github.com/expo/expo-server-sdk-node"},"Node SDK")," implements this for you and opens a maximum of six concurrent connections. This smooths out your peak load and helps the Expo push notification service receive your push notifications successfully."),Object(a.b)("h3",{id:"retry-on-failure"},"Retry on failure"),Object(a.b)("p",null,"The first step of sending push notifications is to deliver them to the Expo push notification service, which internally adds them to a queue to be delivered to Apple (APNs), Google (FCM), or other push notification providers. This first step can fail for several reasons: network issues between your server and the Expo push notification service, an outage or degraded availability of the Expo notification service, misconfigured push credentials, or an invalid notification payload."),Object(a.b)("p",null,"Some of these failures are transient. If the Expo push notification service is down or unreachable and you get a network error, an HTTP 429 error (Too Many Requests), or HTTP 5xx error (Server Errors), use ",Object(a.b)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/"},"exponential backoff")," to wait a few seconds before retrying. If the first retry attempt is unsuccessful, wait for longer (follow exponential backoff) and retry again. This lets the temporarily unavailable service recover before you retry."),Object(a.b)("p",null,"Other failures will not resolve themselves no matter how many times you retry. If your push notification payload is malformed, you may get an HTTP 400 response explaining the issue with the payload. You will also get an error if there are no push credentials for your project or if you send push notifications for different projects in the same request. You must fix the underlying causes of these issues to resolve them."),Object(a.b)("h3",{id:"check-push-receipts-for-errors"},"Check push receipts for errors"),Object(a.b)("p",null,"The Expo push notification service responds with ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications/#push-tickets"},Object(a.b)("em",{parentName:"a"},"push tickets"))," upon successfully receiving notifications. A push ticket indicates that Expo has received your notification payload but may not have sent it yet. Each push ticket contains a ticket ID, which you later use to look up a ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications/#push-receipts"},Object(a.b)("em",{parentName:"a"},"push receipt")),". A push receipt is available after Expo has tried to deliver the notification to APNs, FCM, etc\u2026 and tells you whether delivery to the push notification provider was successful."),Object(a.b)("p",null,"You must check your push receipts. If there is an issue delivering push notifications, the push receipts are the best way to get information about the underlying cause. The receipts may indicate a problem with APNs or FCM, the Expo push notification service, or your notification payload."),Object(a.b)("p",null,"Push receipts may also tell you if a recipient device has unsubscribed from notifications (for example, by revoking notification permissions or uninstalling your app) if the push notification provider like APNs or FCM responds with that information. The push receipt will contain a",Object(a.b)("inlineCode",{parentName:"p"},"details")," \u2192 ",Object(a.b)("inlineCode",{parentName:"p"},"error")," field set to ",Object(a.b)("inlineCode",{parentName:"p"},"DeviceNotRegistered"),". In this scenario, stop sending notifications to this device's push token until it re-registers with your server so your app remains a good citizen. The ",Object(a.b)("inlineCode",{parentName:"p"},"DeviceNotRegistered")," error appears in push receipts only when Apple, Google, or another push notification provider deems the device to be unregistered; it takes an undefined amount of time and is often not possible to test by uninstalling your app and sending a push notification shortly after."),Object(a.b)("p",null,"We recommend checking push receipts 15 minutes after sending your push notifications. While push receipts are often available much sooner, a 15-minute window gives the Expo push notification service a comfortable amount of time to make the receipts available to you. If after 15 minutes there is no push receipt, this likely indicates an error with the Expo push notification service. Lastly, push receipts are cleared after 24 hours."),Object(a.b)("h3",{id:"slas"},"SLAs"),Object(a.b)("p",null,"The Expo push notification service does not have an SLA and the APNs and FCM services also may have occasional outages. By following the guidance above, you can make your application robust against temporary service interruptions."),Object(a.b)("h2",{id:"http2-api"},"HTTP/2 API"),Object(a.b)("p",null,"Instead of using one of the libraries listed earlier, you may want to send requests directly to our HTTP/2 API (this API currently does not require any authentication)."),Object(a.b)("p",null,"To do so, send a POST request to ",Object(a.b)("inlineCode",{parentName:"p"},"https://exp.host/--/api/v2/push/send")," with the following HTTP headers:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"host: exp.host\naccept: application/json\naccept-encoding: gzip, deflate\ncontent-type: application/json\n")),Object(a.b)("p",null,'This is a "hello world" push notification using cURL that you can send using your CLI (replace the placeholder push token with your own):'),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-sh"},'curl -H "Content-Type: application/json" -X POST "https://exp.host/--/api/v2/push/send" -d \'{\n  "to": "ExponentPushToken[xxxxxxxxxxxxxxxxxxxxxx]",\n  "title":"hello",\n  "body": "world"\n}\'\n')),Object(a.b)("p",null,"The request body must be JSON. It may either be a single ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications/#message-request-format"},"message object")," (example above) or an array of up to 100 message objects, as long as they are all for the same project (show below). ",Object(a.b)("strong",{parentName:"p"},"We recommend using an array when you want to send multiple messages to efficiently minimize the number of requests you need to make to Expo servers.")," Here's an example request body that sends four messages:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "to": "ExponentPushToken[xxxxxxxxxxxxxxxxxxxxxx]",\n    "sound": "default",\n    "body": "Hello world!"\n  },\n  {\n    "to": "ExponentPushToken[yyyyyyyyyyyyyyyyyyyyyy]",\n    "badge": 1,\n    "body": "You\'ve got mail"\n  },\n  {\n    "to": [\n      "ExponentPushToken[zzzzzzzzzzzzzzzzzzzzzz]",\n      "ExponentPushToken[aaaaaaaaaaaaaaaaaaaaaa]"\n    ],\n    "body": "Breaking news!"\n  }\n]\n')),Object(a.b)("p",null,"The Expo server also optionally accepts gzip-compressed request bodies. This can greatly reduce the amount of upload bandwidth needed to send large numbers of notifications. The ",Object(a.b)("a",{parentName:"p",href:"https://github.com/expo/expo-server-sdk-node"},"Node Expo Server SDK")," automatically gzips requests for you, and automatically throttles your requests to smooth out the load, so we highly recommend it!"),Object(a.b)("h3",{id:"push-tickets"},"Push tickets"),Object(a.b)("p",null,"The requests above will respond with a JSON object with two optional fields, ",Object(a.b)("inlineCode",{parentName:"p"},"data")," and ",Object(a.b)("inlineCode",{parentName:"p"},"errors"),". ",Object(a.b)("inlineCode",{parentName:"p"},"data")," will contain an array of ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications/#push-ticket-format"},Object(a.b)("strong",{parentName:"a"},"push tickets"))," in the same order in which the messages were sent (or one push ticket object, if you send a single message to a single recipient). Each ticket includes a ",Object(a.b)("inlineCode",{parentName:"p"},"status")," field that indicates whether Expo successfully received the notification and, if successful, an ",Object(a.b)("inlineCode",{parentName:"p"},"id")," field that can be used to later retrieve a push receipt."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},Object(a.b)("strong",{parentName:"p"},"Note"),": a status of ",Object(a.b)("inlineCode",{parentName:"p"},"ok")," along with a receipt ID means that the message was received by Expo's servers, ",Object(a.b)("strong",{parentName:"p"},"not")," that it was received by the user (for that you will need to check the ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications/#push-receipts"},"push receipt"),").")),Object(a.b)("p",null,"Continuing the above example, this is what a successful response body looks like:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'{\n  "data": [\n    { "status": "ok", "id": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX" },\n    { "status": "ok", "id": "YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY" },\n    { "status": "ok", "id": "ZZZZZZZZ-ZZZZ-ZZZZ-ZZZZ-ZZZZZZZZZZZZ" },\n    { "status": "ok", "id": "AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA" }\n  ]\n}\n')),Object(a.b)("p",null,"If there were errors with individual messages, but not the entire request, the bad messages' corresponding push tickets will have a status of ",Object(a.b)("inlineCode",{parentName:"p"},"error"),", and fields that describe the error, like this:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'{\n  "data": [\n    {\n      "status": "error",\n      "message": "\\\\\\"ExponentPushToken[xxxxxxxxxxxxxxxxxxxxxx]\\\\\\" is not a registered push notification recipient",\n      "details": {\n        "error": "DeviceNotRegistered"\n      }\n    },\n    {\n      "status": "ok",\n      "id": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"\n    }\n  ]\n}\n')),Object(a.b)("p",null,"If the entire request failed, the HTTP status code will be 4xx or 5xx and the ",Object(a.b)("inlineCode",{parentName:"p"},"errors")," field will be an array of error objects (usually just one). Otherwise, the HTTP status code will be 200 and your messages will be on their way to the iOS and Android push notification services!"),Object(a.b)("h3",{id:"push-receipts"},"Push receipts"),Object(a.b)("p",null,"After receiving a batch of notifications, Expo enqueues each notification to be delivered to the iOS and Android push notification services (APNs and FCM, respectively). Most notifications are typically delivered within a few seconds. Sometimes it may take longer to deliver notifications, particularly if the iOS or Android push notification services are taking longer than usual to receive and deliver notifications, or if Expo's cloud infrastructure is under high load."),Object(a.b)("p",null,"Once Expo delivers a notification to the iOS or Android push notification service, Expo creates a ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications/#push-receipt-response-format"},Object(a.b)("strong",{parentName:"a"},"push receipt"))," that indicates whether the iOS or Android push notification service successfully received the notification. If there was an error delivering the notification, perhaps due to faulty credentials or service downtime, the push receipt will contain more information regarding that error."),Object(a.b)("p",null,"To fetch the push receipts, send a POST request to ",Object(a.b)("inlineCode",{parentName:"p"},"https://exp.host/--/api/v2/push/getReceipts"),". The ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications/#push-receipt-request-format"},"request body")," must be a JSON object with a field name ",Object(a.b)("inlineCode",{parentName:"p"},"ids")," that is an array of ticket ID strings:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-sh"},'curl -H "Content-Type: application/json" -X POST "https://exp.host/--/api/v2/push/getReceipts" -d \'{\n  "ids": [\n    "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",\n    "YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY",\n    "ZZZZZZZZ-ZZZZ-ZZZZ-ZZZZ-ZZZZZZZZZZZZ",\n  ]\n}\'\n')),Object(a.b)("p",null,"The ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/sending-notifications/#push-receipt-response-format"},"response body")," for push receipts is very similar to that of push tickets; it is a JSON object with two optional fields, ",Object(a.b)("inlineCode",{parentName:"p"},"data")," and ",Object(a.b)("inlineCode",{parentName:"p"},"errors"),". ",Object(a.b)("inlineCode",{parentName:"p"},"data")," contains a mapping of receipt IDs to receipts. Receipts include a ",Object(a.b)("inlineCode",{parentName:"p"},"status")," field, and two optional ",Object(a.b)("inlineCode",{parentName:"p"},"message")," and ",Object(a.b)("inlineCode",{parentName:"p"},"details")," fields (in the case where ",Object(a.b)("inlineCode",{parentName:"p"},'"status": "error"'),"). If there is no push receipt for a requested receipt ID, the mapping won't contain that ID. This is what a successful response to the above request looks like:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX": { "status": "ok" },\n    "ZZZZZZZZ-ZZZZ-ZZZZ-ZZZZ-ZZZZZZZZZZZZ": { "status": "ok" }\n    // When there is no receipt with a given ID (YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY in this\n    // example), the ID is omitted from the response.\n  }\n}\n')),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"You must check each push receipt, since they may contain information about errors you need to resolve.")," For example, if a device is no longer eligible to receive notifications, Apple's documentation asks that you stop sending notifications to that device. The push receipts will contain information about these errors."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},Object(a.b)("strong",{parentName:"p"},"Note:")," Even if a receipt's ",Object(a.b)("inlineCode",{parentName:"p"},"status")," says ",Object(a.b)("inlineCode",{parentName:"p"},"ok"),", this doesn't guarantee that the device has received the message; \"ok\" in a push receipt means that the Android or iOS push notification service successfully received the notification. If the recipient device is turned off, for example, the iOS or Android push notification service will try to deliver the message but the device won't necessarily receive it.")),Object(a.b)("p",null,"If the entire request failed, the HTTP status code will be 4xx or 5xx and the ",Object(a.b)("inlineCode",{parentName:"p"},"errors")," field will be an array of error objects (usually just one). Otherwise, the HTTP status code will be 200 and your messages will be on their way to your users' devices!"),Object(a.b)("h2",{id:"errors"},"Errors"),Object(a.b)("p",null,"Expo provides details regarding any errors that occur during this entire process. We'll cover some of the most common errors below so that you can implement logic to handle them automatically on your server. If, for whatever reason, Expo couldn't deliver the message to the Android or iOS push notification service, the push receipt's details may also include service-specific information. This is useful mostly for debugging and reporting possible bugs to Expo."),Object(a.b)("h3",{id:"individual-errors"},"Individual errors"),Object(a.b)("p",null,"Inside both push tickets and push receipts, look for a ",Object(a.b)("inlineCode",{parentName:"p"},"details")," object with an ",Object(a.b)("inlineCode",{parentName:"p"},"error")," field. If present, it may be one of the following values, and you should handle these errors like so:"),Object(a.b)("h3",{id:"push-ticket-errors"},"Push ticket errors"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"DeviceNotRegistered"),": the device cannot receive push notifications anymore and you should stop sending messages to the corresponding Expo push token.")),Object(a.b)("h3",{id:"push-receipt-errors"},"Push receipt errors"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("inlineCode",{parentName:"p"},"DeviceNotRegistered"),": the device cannot receive push notifications anymore and you should stop sending messages to the corresponding Expo push token.")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("inlineCode",{parentName:"p"},"MessageTooBig"),": the total notification payload was too large. On Android and iOS the total payload must be at most 4096 bytes.")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("inlineCode",{parentName:"p"},"MessageRateExceeded"),": you are sending messages too frequently to the given device. Implement exponential backoff and slowly retry sending messages.")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("inlineCode",{parentName:"p"},"MismatchSenderId"),": There is an issue with your FCM push credentials. There are two pieces to FCM push credentials: your FCM server key, and your ",Object(a.b)("inlineCode",{parentName:"p"},"google-services.json")," file. Both must be associated with the same sender ID. You can find your sender ID in the ",Object(a.b)("a",{parentName:"p",href:"/../../../../../../push-notifications/using-fcm/#uploading-server-credentials"},"same place you find your server key"),". Check that the server key is the same as the one returned from running ",Object(a.b)("inlineCode",{parentName:"p"},"expo push:android:show"),", and that the sender ID is the same as the one in your project's ",Object(a.b)("inlineCode",{parentName:"p"},"google-services.json")," file (under ",Object(a.b)("inlineCode",{parentName:"p"},"project_number"),").")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("inlineCode",{parentName:"p"},"InvalidCredentials"),": your push notification credentials for your standalone app are invalid (ex: you may have revoked them). Run ",Object(a.b)("inlineCode",{parentName:"p"},"expo build:ios -c")," to regenerate new push notification credentials for iOS. If you revoke an APN key, all apps that rely on that key will no longer be able to send or receive push notifications until you upload a new key to replace it. Uploading a new APN key will ",Object(a.b)("strong",{parentName:"p"},"not")," change your users' Expo Push Tokens."),Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"Sometimes, these errors will contain further details claiming an ",Object(a.b)("inlineCode",{parentName:"li"},"InvalidProviderToken")," error. This is actually tied to both your APN key ",Object(a.b)("strong",{parentName:"li"},"and")," your provisioning profile. To resolve this error, you should rebuild the app and regenerate a new push key and provisioning profile.")))),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"Note: For a better understanding of iOS credentials, including push notification credentials, read our ",Object(a.b)("a",{parentName:"p",href:"/../../../../../../app-signing/app-credentials/#ios"},"App Signing docs"))),Object(a.b)("h3",{id:"request-errors"},"Request errors"),Object(a.b)("p",null,"If there's an error with the entire request for either push tickets or push receipts, the ",Object(a.b)("inlineCode",{parentName:"p"},"errors")," object may be one of the following values, and you should handle these errors like so:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("inlineCode",{parentName:"p"},"PUSH_TOO_MANY_EXPERIENCE_IDS"),": you are trying to send push notifications to different Expo experiences, for example ",Object(a.b)("inlineCode",{parentName:"p"},"@username/projectAAA")," and ",Object(a.b)("inlineCode",{parentName:"p"},"@username/projectBBB"),". Check the ",Object(a.b)("inlineCode",{parentName:"p"},"details")," field for a mapping of experience names to their associated push tokens from the request, and remove any from another experience.")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("inlineCode",{parentName:"p"},"PUSH_TOO_MANY_NOTIFICATIONS"),": you are trying to send more than 100 push notifications in one request. Make sure you are only sending 100 (or less) notifications in each request.")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},Object(a.b)("inlineCode",{parentName:"p"},"PUSH_TOO_MANY_RECEIPTS"),": you are trying to get more than 1000 push receipts in one request. Make sure you are only sending an array of 1000 (or less) ticket ID strings to get your push receipts."))),Object(a.b)("h2",{id:"additional-security"},"Additional Security"),Object(a.b)("p",null,"You can require any push requests to be sent with a valid ",Object(a.b)("a",{parentName:"p",href:"/../../../../../../accounts/programmatic-access/"},"access token")," before we will deliver them to your users. You can enable this enhanced push security from your ",Object(a.b)("a",{parentName:"p",href:"https://expo.dev/settings/access-tokens"},"Expo Dashboard"),"."),Object(a.b)("p",null,"By default, you can send a notification to your users by sending their Expo Push Token and any text or additional data needed for the message. This is easy to set up, but ",Object(a.b)("strong",{parentName:"p"},"if the tokens are leaked, a malicious user would be able to impersonate your app and send their own message to your users.")," We have never had an instance of this reported; however, to follow best security practices, we offer the use of an access token alongside the push token as an additional layer of security."),Object(a.b)("p",null,"If you're using the ",Object(a.b)("a",{parentName:"p",href:"https://github.com/expo/expo-server-sdk-node#usage"},Object(a.b)("inlineCode",{parentName:"a"},"expo-server-sdk-node")),", upgrade to at least v3.6.0 and pass your ",Object(a.b)("inlineCode",{parentName:"p"},"accessToken")," as an option in the constructor. Otherwise, pass in the header ",Object(a.b)("inlineCode",{parentName:"p"},"'Authorization': 'Bearer ${accessToken}'")," with any requests to our push API."),Object(a.b)("p",null,"Any requests sent ",Object(a.b)("em",{parentName:"p"},"without")," a valid access token ",Object(a.b)("em",{parentName:"p"},"after")," you enable push security will result in an error with code: ",Object(a.b)("inlineCode",{parentName:"p"},"UNAUTHORIZED"),"."),Object(a.b)("h2",{id:"formats"},"Formats"),Object(a.b)("h3",{id:"message-request-format"},"Message request format"),Object(a.b)("p",null,"Each message must be a JSON object with the given fields (only the ",Object(a.b)("inlineCode",{parentName:"p"},"to")," field is required):"),Object(a.b)("table",null,Object(a.b)("thead",{parentName:"table"},Object(a.b)("tr",{parentName:"thead"},Object(a.b)("th",{parentName:"tr",align:null},"Field"),Object(a.b)("th",{parentName:"tr",align:null},"Platform?"),Object(a.b)("th",{parentName:"tr",align:null},"Type"),Object(a.b)("th",{parentName:"tr",align:null},"Description"))),Object(a.b)("tbody",{parentName:"table"},Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"to")),Object(a.b)("td",{parentName:"tr",align:null},"iOS & Android"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)(s.b,{mdxType:"InlineCode"},"string ","|"," string[]")),Object(a.b)("td",{parentName:"tr",align:null},"An Expo push token or an array of Expo push tokens specifying the recipient(s) of this message.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"data")),Object(a.b)("td",{parentName:"tr",align:null},"iOS & Android"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"Object")),Object(a.b)("td",{parentName:"tr",align:null},'A JSON object delivered to your app. It may be up to about 4KiB; the total notification payload sent to Apple and Google must be at most 4KiB or else you will get a "Message Too Big" error.')),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"title")),Object(a.b)("td",{parentName:"tr",align:null},"iOS & Android"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"string")),Object(a.b)("td",{parentName:"tr",align:null},"The title to display in the notification. Often displayed above the notification body")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"body")),Object(a.b)("td",{parentName:"tr",align:null},"iOS & Android"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"string")),Object(a.b)("td",{parentName:"tr",align:null},"The message to display in the notification.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"ttl")),Object(a.b)("td",{parentName:"tr",align:null},"iOS & Android"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"number")),Object(a.b)("td",{parentName:"tr",align:null},"Time to Live: the number of seconds for which the message may be kept around for redelivery if it hasn't been delivered yet. Defaults to ",Object(a.b)("inlineCode",{parentName:"td"},"undefined")," in order to use the respective defaults of each provider (0 for iOS/APNs and 2419200 (4 weeks) for Android/FCM).")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"expiration")),Object(a.b)("td",{parentName:"tr",align:null},"iOS & Android"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"number")),Object(a.b)("td",{parentName:"tr",align:null},"Timestamp since the UNIX epoch specifying when the message expires. Same effect as ",Object(a.b)("inlineCode",{parentName:"td"},"ttl")," (",Object(a.b)("inlineCode",{parentName:"td"},"ttl")," takes precedence over ",Object(a.b)("inlineCode",{parentName:"td"},"expiration"),").")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"priority")),Object(a.b)("td",{parentName:"tr",align:null},"iOS & Android"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)(s.b,{mdxType:"InlineCode"},"'default' ","|"," 'normal' ","|"," 'high'")),Object(a.b)("td",{parentName:"tr",align:null},'The delivery priority of the message. Specify "default" or omit this field to use the default priority on each platform ("normal" on Android and "high" on iOS).')),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"subtitle")),Object(a.b)("td",{parentName:"tr",align:null},"iOS Only"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"string")),Object(a.b)("td",{parentName:"tr",align:null},"The subtitle to display in the notification below the title.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"sound")),Object(a.b)("td",{parentName:"tr",align:null},"iOS Only"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)(s.b,{mdxType:"InlineCode"},"'default' ","|"," null")),Object(a.b)("td",{parentName:"tr",align:null},"Play a sound when the recipient receives this notification. Specify ",Object(a.b)("inlineCode",{parentName:"td"},'"default"')," to play the device's default notification sound, or omit this field to play no sound. Custom sounds are not supported.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"badge")),Object(a.b)("td",{parentName:"tr",align:null},"iOS Only"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"number")),Object(a.b)("td",{parentName:"tr",align:null},"Number to display in the badge on the app icon. Specify zero to clear the badge.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"channelId")),Object(a.b)("td",{parentName:"tr",align:null},"Android Only"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"string")),Object(a.b)("td",{parentName:"tr",align:null},"ID of the Notification Channel through which to display this notification. If an ID is specified but the corresponding channel does not exist on the device (i.e. has not yet been created by your app), the notification will not be displayed to the user.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"categoryId")),Object(a.b)("td",{parentName:"tr",align:null},"iOS & Android"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"string")),Object(a.b)("td",{parentName:"tr",align:null},"ID of the notification category that this notification is associated with. ",Object(a.b)("a",{parentName:"td",href:"/../../../../../../versions/latest/sdk/notifications/#managing-notification-categories-interactive-notifications"},"Find out more about notification categories here"),". Must be on at least SDK 41 or bare workflow.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"mutableContent")),Object(a.b)("td",{parentName:"tr",align:null},"iOS Only"),Object(a.b)("td",{parentName:"tr",align:null},Object(a.b)("inlineCode",{parentName:"td"},"boolean")),Object(a.b)("td",{parentName:"tr",align:null},"Specifies whether this notification can be ",Object(a.b)("a",{parentName:"td",href:"https://developer.apple.com/documentation/usernotifications/modifying_content_in_newly_delivered_notifications?language=objc"},"intercepted by the client app"),". In Expo Go, this defaults to ",Object(a.b)("inlineCode",{parentName:"td"},"true"),", and if you change that to false, you may experience issues. In standalone and bare apps, this defaults to ",Object(a.b)("inlineCode",{parentName:"td"},"false"),".")))),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Note on ",Object(a.b)("inlineCode",{parentName:"strong"},"ttl")),": On Android, we make a best effort to deliver messages with zero TTL immediately and do not throttle them. However, setting TTL to a low value (e.g. zero) can prevent normal-priority notifications from ever reaching Android devices that are in doze mode. In order to guarantee that a notification will be delivered, TTL must be long enough for the device to wake from doze mode. This field takes precedence over ",Object(a.b)("inlineCode",{parentName:"p"},"expiration")," when both are specified."),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Note on ",Object(a.b)("inlineCode",{parentName:"strong"},"priority")),": On Android, normal-priority messages won't open network connections on sleeping devices and their delivery may be delayed to conserve the battery. High-priority messages are delivered immediately if possible and may wake sleeping devices to open network connections, consuming energy. On iOS, normal-priority messages are sent at a time that takes into account power considerations for the device, and may be grouped and delivered in bursts. They are throttled and may not be delivered by Apple. High-priority messages are sent immediately. Normal priority corresponds to APNs priority level 5 and high priority to 10."),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Note on ",Object(a.b)("inlineCode",{parentName:"strong"},"channelId")),': If left null, a "Default" channel will be used, and Expo will create the channel on the device if it does not yet exist. However, use caution, as the "Default" channel is user-facing and you may not be able to fully delete it.'),Object(a.b)("h3",{id:"push-ticket-format"},"Push ticket format"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": [\n    {\n      "status": "error" | "ok",\n      "id": string, // this is the Receipt ID\n      // if status === "error"\n      "message": string,\n      "details": JSON\n    },\n    ...\n  ],\n  // only populated if there was an error with the entire request\n  "errors": [{\n    "code": number,\n    "message": string\n  }]\n}\n')),Object(a.b)("h3",{id:"push-receipt-request-format"},"Push receipt request format"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},'{\n  "ids": string[]\n}\n')),Object(a.b)("h3",{id:"push-receipt-response-format"},"Push receipt response format"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": {\n    Receipt ID: {\n      "status": "error" | "ok",\n      // if status === "error"\n      "message": string,\n      "details": JSON\n    },\n    ...\n  },\n  // only populated if there was an error with the entire request\n  "errors": [{\n    "code": string,\n    "message": string\n  }]\n}\n')),Object(a.b)("h2",{id:"delivery-guarantees"},"Delivery Guarantees"),Object(a.b)("p",null,"Expo makes a best effort to deliver notifications to the push notification services operated by Apple and Google. Expo's infrastructure is designed for at-least-once delivery to the underlying push notification services; it is more likely for a notification to be delivered to Apple or Google more than once rather than not at all, though both are uncommon but possible."),Object(a.b)("p",null,'After a notification has been handed off to an underlying push notification service, Expo creates a "push receipt" that records whether the handoff was successful; a push receipt denotes whether the underlying push notification service received the notification.'),Object(a.b)("p",null,"Finally, the push notification services from Apple, Google, etc... make a best effort to deliver the notification to the device according to their own policies."),Object(a.b)("h2",{id:"next-steps"},"Next steps"),Object(a.b)("p",null,"Now that you can send notifications to your app, set your app up for ",Object(a.b)("a",{parentName:"p",href:"/push-notifications/receiving-notifications/"},"receiving notifications and taking action based on those events"),"!"),Object(a.b)("h2",{id:"see-also"},"See also"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Having trouble? Visit ",Object(a.b)("a",{parentName:"li",href:"/push-notifications/faq/"},"Expo's notification FAQ page"))))}b.isMDXComponent=!0},"7LId":function(e,t,n){"use strict";function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}n.d(t,"a",(function(){return o}))},"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var i=n("q1tI"),o=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),p=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"===typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,r=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),d=i,h=u["".concat(r,".").concat(d)]||u[d]||b[d]||a;return n?o.a.createElement(h,s(s({ref:t},l),{},{components:n})):o.a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"===typeof e||i){var a=n.length,r=new Array(a);r[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"===typeof e?e:i,r[1]=s;for(var l=2;l<a;l++)r[l]=n[l];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},"C+bE":function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},"H+61":function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return i}))},KiYJ:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("cpVT"),o=n("3zh3"),a=(n("q1tI"),n("AeFk"));function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e){var t=e.alt,n=e.src,i=e.style,r=e.containerStyle;return Object(a.c)("div",{style:s({textAlign:"center",backgroundColor:o.theme.background.secondary,paddingTop:10,paddingBottom:10,marginTop:20,marginBottom:20},r)},Object(a.c)("img",{src:n,alt:t,style:i}))}},UlJF:function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.d(t,"a",(function(){return o}))},VIvw:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("C+bE"),o=n.n(i),a=n("+Css");function r(e,t){if(t&&("object"===o()(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Object(a.a)(e)}},cpVT:function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return i}))},ecK7:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/push-notifications/sending-notifications",function(){return n("+p6c")}])},iHvq:function(e,t,n){"use strict";function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return i}))}},[["ecK7",1,0,2,3,7]]]);