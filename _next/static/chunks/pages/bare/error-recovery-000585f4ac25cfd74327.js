_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[44],{"7H/0":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/bare/error-recovery",function(){return n("iKUG")}])},"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var a=n("q1tI"),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),c=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"===typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),u=c(n),b=a,h=u["".concat(i,".").concat(b)]||u[b]||d[b]||o;return n?r.a.createElement(h,l(l({ref:t},s),{},{components:n})):r.a.createElement(h,l({ref:t},s))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"===typeof e||a){var o=n.length,i=new Array(o);i[0]=b;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"===typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},HALo:function(e,t,n){"use strict";function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}n.d(t,"a",(function(){return a}))},Qetd:function(e,t,n){"use strict";var a=Object.assign.bind(Object);e.exports=a,e.exports.default=e.exports},dhJC:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}n.d(t,"a",(function(){return a}))},iKUG:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return l})),n.d(t,"headings",(function(){return p})),n.d(t,"default",(function(){return c}));var a=n("HALo"),r=n("dhJC"),o=(n("q1tI"),n("7ljp")),i=["components"],l={title:"Error Recovery",sidebar_title:"Error Recovery"},p=[{depth:2,type:"text",title:"Help! I published a broken update to production. What should I do?"},{depth:2,type:"text",title:"Explaining the error recovery flow"},{depth:3,type:"text",title:"Catching an error"},{depth:3,type:"text",title:"If content has appeared"},{depth:3,type:"text",title:"If content has not appeared"},{depth:2,type:"inlineCode",title:"Note about  expo-error-recovery"}],s={meta:l,headings:p};function c(e){var t=e.components,n=Object(r.a)(e,i);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Apps using ",Object(o.b)("inlineCode",{parentName:"p"},"expo-updates")," can take advantage of built-in error recovery behavior as an extra safeguard against accidentally publishing broken updates."),Object(o.b)("p",null,"While we cannot stress enough the importance of testing updates in a staging environment before publishing to production, humans (and even computers) occasionally make mistakes, and the error recovery behavior described here can serve as a last resort in such cases."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Disclaimer: the behavior documented below is subject to change and should not be relied upon. Always test your code carefully and thoroughly in production-like environments before publishing updates.")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"The behavior documented on this page applies to bare apps as well as apps built with EAS Build, ",Object(o.b)("strong",{parentName:"p"},"not")," apps built with ",Object(o.b)("inlineCode",{parentName:"p"},"expo build:ios")," or ",Object(o.b)("inlineCode",{parentName:"p"},"expo build:android")," (which have a separate error recovery mechanism that uses ",Object(o.b)("a",{parentName:"p",href:"/../../../../../../versions/latest/sdk/error-recovery"},Object(o.b)("inlineCode",{parentName:"a"},"expo-error-recovery")),").")),Object(o.b)("h2",{id:"help-i-published-a-broken-update-to-production-what-should-i-do"},"Help! I published a broken update to production. What should I do?"),Object(o.b)("p",null,"First of all, don't panic. Mistakes happen; most likely, everything will be fine."),Object(o.b)("p",null,"The important thing is to ",Object(o.b)("strong",{parentName:"p"},"publish a new update with a fix as soon as possible (though not before you are 100% confident in your fix).")," The error recovery mechanism in ",Object(o.b)("inlineCode",{parentName:"p"},"expo-updates")," will ensure that in most cases, even users who have already downloaded the broken update should be able to get the fix."),Object(o.b)("p",null,"The first thing to try is rolling back to an older update that you know was working. ",Object(o.b)("strong",{parentName:"p"},"However, this may not always be safe;")," your broken update may, for example, have modified persistent state (such as data stored in AsyncStorage or on the device's file system) in a non-backwards-compatible way. It's important to test in a staging environment that emulates an end user's device state as closely as possible\u2014i.e. load the broken update and then roll back."),Object(o.b)("p",null,"If you can identify an older update that is safe to roll back to, you can do so using ",Object(o.b)("a",{parentName:"p",href:"/../../../../../../eas-update/eas-update-and-eas-cli/#republish-a-previous-update-within-a-branch"},"EAS Update's ",Object(o.b)("inlineCode",{parentName:"a"},"republish")," option"),". If you're using classic Expo-hosted updates (",Object(o.b)("inlineCode",{parentName:"p"},"expo publish"),") or hosting your updates on your own server, you'll need to publish a new update with your old code in order to generate an update with a new ID and publish date."),Object(o.b)("p",null,"If you cannot identify an older update that is safe to roll back to, you'll need to fix forward. While it's best to roll out a fix as quickly as possible, you should take the time to ensure your fix is solid, and know that even users who download your broken update in the meantime should be able to download your fix."),Object(o.b)("p",null,"If you'd like more details about how this works, read on."),Object(o.b)("h2",{id:"explaining-the-error-recovery-flow"},"Explaining the error recovery flow"),Object(o.b)("p",null,"The error recovery flow is intended to be as lightweight as possible. It is not a full safety net that protects your end users from the results of errors; in many cases users will still see a crash."),Object(o.b)("p",null,'Rather, the purpose is to prevent updates from "bricking" your app (causing a crash on launch before the app can check for updates, making the app unusable until uninstalled and reinstalled) by ensuring that in as many cases as possible, the app has the opportunity to download a new update and fix itself.'),Object(o.b)("h3",{id:"catching-an-error"},"Catching an error"),Object(o.b)("p",null,"If your app throws a fatal error when executing JS which is early enough in the app's lifecycle that it may prevent the app from being able to download further updates, ",Object(o.b)("inlineCode",{parentName:"p"},"expo-updates")," will catch this error."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"If more than 10 seconds have elapsed between your app's first render and the time a fatal error is thrown, ",Object(o.b)("inlineCode",{parentName:"p"},"expo-updates")," will not catch this error at all and none of the error recovery code will be triggered. Therefore, we highly recommend that your app check for updates very shortly after launching, whether ",Object(o.b)("a",{parentName:"p",href:"/../../../../../../bare/updating-your-app/#automatic-updates"},"automatically")," or ",Object(o.b)("a",{parentName:"p",href:"/../../../../../../bare/updating-your-app/#manual-updates"},"manually")," to ensure you can push out fixes in the event of a future error.")),Object(o.b)("p",null,"If ",Object(o.b)("inlineCode",{parentName:"p"},"expo-updates"),' catches a JS error, what will happen next depends on whether React Native has fired the native "content appeared" event (',Object(o.b)("inlineCode",{parentName:"p"},"RCTContentDidAppearNotification")," on iOS, or ",Object(o.b)("inlineCode",{parentName:"p"},"ReactMarkerConstants.CONTENT_APPEARED")," on Android)\u2014approximately when your app's first view has been rendered on the screen\u2014for this particular update, either on this launch or a previous one."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"\ud83d\udca1 ",Object(o.b)("strong",{parentName:"p"},"Why this distinction?")," In some cases ",Object(o.b)("inlineCode",{parentName:"p"},"expo-updates")," may try to automatically roll back to an older (working) update, but this can be dangerous if your new update has modified persistent state in a non-backwards compatible way. We assume that if the error occurs before the first view has rendered, no such code has been able to execute, and so rolling back is safe. After this point ",Object(o.b)("inlineCode",{parentName:"p"},"expo-updates")," will only fix forward and will not roll back.")),Object(o.b)("h3",{id:"if-content-has-appeared"},"If content has appeared"),Object(o.b)("p",null,'If an error is caught and the "content appeared" event has already fired, OR if it has ever been fired on this device on a past launch of the same update, the following will happen:'),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"A 5 second timer will be started, and (unless ",Object(o.b)("inlineCode",{parentName:"li"},"EXUpdatesCheckOnLaunch"),"/",Object(o.b)("inlineCode",{parentName:"li"},"expo.modules.updates.EXPO_UPDATES_CHECK_ON_LAUNCH")," is set to ",Object(o.b)("inlineCode",{parentName:"li"},"NEVER"),") the app will check for a new update and download it if there is one."),Object(o.b)("li",{parentName:"ul"},"If there is no new update, the update finishes downloading, or the timer runs out (whichever happens first), the app will throw the original error and crash.")),Object(o.b)("p",null,"Note that if a new update is downloaded, it will launch when the user next tries to open the app."),Object(o.b)("h3",{id:"if-content-has-not-appeared"},"If content has not appeared"),Object(o.b)("p",null,'If an error is caught before the "content appeared" event has fired, AND this is the first time the current update is being launched on this device, the following will happen:'),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},'The update will be marked as "failed" locally and will not be launched again on this device.'),Object(o.b)("li",{parentName:"ul"},"A 5 second timer will be started, and (unless ",Object(o.b)("inlineCode",{parentName:"li"},"EXUpdatesCheckOnLaunch"),"/",Object(o.b)("inlineCode",{parentName:"li"},"expo.modules.updates.EXPO_UPDATES_CHECK_ON_LAUNCH")," is set to ",Object(o.b)("inlineCode",{parentName:"li"},"NEVER"),") the app will check for a new update and download it if there is one."),Object(o.b)("li",{parentName:"ul"},"If a new update finishes downloading before the timer runs out, the app will immediately try to reload itself and launch the newly downloaded update."),Object(o.b)("li",{parentName:"ul"},"If this newly downloaded update also throws a fatal error, OR there is no new update, OR the timer runs out, the app will immediately try to reload by rolling back to an older update, whichever one was most recently launched successfully."),Object(o.b)("li",{parentName:"ul"},"If this also fails, or there is no older update available on the device, the app will throw the original error and crash.")),Object(o.b)("h2",{id:"note-about-expo-error-recovery"},"Note about ",Object(o.b)("inlineCode",{parentName:"h2"},"expo-error-recovery")),Object(o.b)("p",null,"Currently, the error recovery behavior of Expo apps differs between apps built with ",Object(o.b)("inlineCode",{parentName:"p"},"expo build:ios"),"/",Object(o.b)("inlineCode",{parentName:"p"},"expo build:android")," and apps built with EAS Build or locally."),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"expo-error-recovery")," package is intended for use only for the former case and does not currently integrate with bare apps or apps built with EAS Build."))}c.isMDXComponent=!0}},[["7H/0",1,0]]]);