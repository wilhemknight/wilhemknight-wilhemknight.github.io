_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[98],{"5hA/":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/distribution/optimizing-updates",function(){return n("XLbJ")}])},"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return m}));var a=n("q1tI"),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=i.a.createContext({}),l=function(e){var t=i.a.useContext(u),n=t;return e&&(n="function"===typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return i.a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},h=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),c=l(n),h=a,m=c["".concat(r,".").concat(h)]||c[h]||d[h]||o;return n?i.a.createElement(m,s(s({ref:t},u),{},{components:n})):i.a.createElement(m,s({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"===typeof e||a){var o=n.length,r=new Array(o);r[0]=h;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"===typeof e?e:a,r[1]=s;for(var u=2;u<o;u++)r[u]=n[u];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},HALo:function(e,t,n){"use strict";function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}n.d(t,"a",(function(){return a}))},Qetd:function(e,t,n){"use strict";var a=Object.assign.bind(Object);e.exports=a,e.exports.default=e.exports},XLbJ:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return s})),n.d(t,"headings",(function(){return p})),n.d(t,"default",(function(){return l}));var a=n("HALo"),i=n("dhJC"),o=(n("q1tI"),n("7ljp")),r=["components"],s={title:"Optimizing Updates"},p=[{depth:2,type:"text",title:"What's in an update?"},{depth:3,type:"text",title:"Estimating the size of an update"},{depth:2,type:"text",title:"Limits on the updates service"},{depth:3,type:"text",title:"Optimize images"},{depth:3,type:"text",title:"Reduce large dependencies"},{depth:3,type:"text",title:"Download files when needed"},{depth:2,type:"text",title:"Building your app on your own computer"},{depth:2,type:"text",title:"Self-hosting your updates"},{depth:2,type:"text",title:"A glimpse at the future"}],u={meta:s,headings:p};function l(e){var t=e.components,n=Object(i.a)(e,r);return Object(o.b)("wrapper",Object(a.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"whats-in-an-update"},"What's in an update?"),Object(o.b)("p",null,"An update for an Expo app comprises the JavaScript, manifest, images, and other assets that a compatible Expo client app, such as Expo Go and production apps, can download and run."),Object(o.b)("p",null,"On Android and iOS, the standalone apps you submit to the app stores are examples of client apps that run your updates. On the web, the web browser is the client app that runs updates. In fact, on the web, Expo updates are just web applications."),Object(o.b)("p",null,"Updates are embedded in standalone apps and subsequent updates are delivered over the internet after a standalone app has been built. Because downloading an update over the internet uses bandwidth and takes time, one of the most effective ways to optimize update delivery is to make it smaller. This guide covers some ways to reduce the sizes of your updates."),Object(o.b)("h3",{id:"estimating-the-size-of-an-update"},"Estimating the size of an update"),Object(o.b)("p",null,"One way to estimate the size of an update is to run ",Object(o.b)("inlineCode",{parentName:"p"},"expo export"),", which exports an update for each platform, which can be self-hosted. The update includes a JSON manifest, a JavaScript bundle, and several assets like images and custom fonts."),Object(o.b)("p",null,"Exported updates contain uncompressed files, unless those file formats are intrinsically compressed, like JPEG and PNG. The size of an update embedded in a standalone app is typically the sum of the sizes of the update's files."),Object(o.b)("p",null,"When updates are served through the updates service, they are compressed with gzip. To estimate the size of a manifest or JavaScript bundle when served through the updates service, run ",Object(o.b)("inlineCode",{parentName:"p"},"gzip <file>"),". Other files like JPEG images and MP3 audio files are already compressed by virtue of their file formats, and the CDN does not need to compress them further."),Object(o.b)("h2",{id:"limits-on-the-updates-service"},"Limits on the updates service"),Object(o.b)("p",null,"The way to think about publishing an update to your Expo app is like publishing a new version of your website. In fact, when you publish an update to your Expo web app, you're publishing a new version of your site. Regardless of the underlying platform, Expo updates are downloaded by users running your app on Android, iOS, and the web and the smaller your update, the faster and more reliably your users will be able to download them and use up less of their data plans on cell connections."),Object(o.b)("p",null,"Expo's current updates service is designed to accommodate updates, which comprise JS code and assets, around 50 MiB. Many well-engineered production apps use far less than this, which contributes to better user experiences."),Object(o.b)("p",null,"Below are a couple of general techniques that help reduce the size of updates. Many of them are also techniques to optimize websites since both Expo updates and websites are served over the web."),Object(o.b)("h3",{id:"optimize-images"},"Optimize images"),Object(o.b)("p",null,"Many images can be reduced by more than 30% in size if they haven't been previously optimized. One simple way to optimize images is to resize them to the dimensions your app actually uses; if your image dimensions are 4032x3024 but your app only needs to display a 400x300 image, downsizing your image with a good interpolation algorithm like bicubic sharpening will greatly reduce your image's size."),Object(o.b)("p",null,"Another way to optimize images is to re-encode them using an optimizer like ",Object(o.b)("a",{parentName:"p",href:"https://github.com/expo/expo-cli/tree/main/packages/expo-optimize#-welcome-to-expo-optimize"},"expo-optimize"),", which optimizes all compatible images in you Expo project:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"npm install -g sharp-cli\nnpx expo-optimize <project-directory> [options]\n")),Object(o.b)("p",null,"There are many other image optimizers you may like to use like ",Object(o.b)("a",{parentName:"p",href:"https://github.com/tjko/jpegoptim"},"jpegoptim"),", ",Object(o.b)("a",{parentName:"p",href:"https://github.com/google/guetzli"},"guetzli"),", ",Object(o.b)("a",{parentName:"p",href:"https://pmt.sourceforge.io/pngcrush/"},"pngcrush"),", or ",Object(o.b)("a",{parentName:"p",href:"http://optipng.sourceforge.net/"},"optipng"),". ",Object(o.b)("a",{parentName:"p",href:"https://github.com/imagemin/imagemin"},"imagemin")," is another program and JS library that supports plugins for various optimizers. There are also many online services that can optimize your images for you."),Object(o.b)("p",null,"Some image optimizers are lossless. This means they re-encode your image to be smaller without any change, or loss, in the pixels that are displayed. When you need each pixel to be untouched from the original image, a lossless optimizer and a lossless image format like PNG is a good choice.\nOther image optimizers are lossy, which means the optimized image is different than the original image. Often, lossy optimizers are more efficient because they discard visual information that reduces file size while making the image look nearly the same to humans. Tools like ",Object(o.b)("inlineCode",{parentName:"p"},"imagemagick")," can use comparison algorithms like ",Object(o.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Structural_similarity"},"SSIM")," to give a sense of how similar two images look. It's quite common for an optimized image that is over 95% similar to the original image to be far less than 95% of the original file size!"),Object(o.b)("h3",{id:"reduce-large-dependencies"},"Reduce large dependencies"),Object(o.b)("p",null,"Large npm dependencies can contribute greatly to the size of your code in an update. While dependencies like ",Object(o.b)("inlineCode",{parentName:"p"},"expo"),", ",Object(o.b)("inlineCode",{parentName:"p"},"react"),", and several more packages are necessary and very useful, sometimes a dependency can be surprisingly large even if you use only one method from it, or you might have multiple versions of the same dependency in your JS bundle. ",Object(o.b)("a",{parentName:"p",href:"https://github.com/IjzerenHein/react-native-bundle-visualizer"},Object(o.b)("inlineCode",{parentName:"a"},"react-native-bundle-visualizer"))," works for Expo apps as well as bare React Native apps and shows a detailed view of the files in your JS bundle."),Object(o.b)("h3",{id:"download-files-when-needed"},"Download files when needed"),Object(o.b)("p",null,"Sometimes apps include files that they don't need right away when the app launches In these scenarios, you can upload these extra files to your own servers and reference the URLs from your application code via ",Object(o.b)("inlineCode",{parentName:"p"},"fetch(url)")," or ",Object(o.b)("inlineCode",{parentName:"p"},"<Image source={{ uri: url }}>"),", for example. By downloading these files on demand, you can move them out of the update and reduce its size."),Object(o.b)("h2",{id:"building-your-app-on-your-own-computer"},"Building your app on your own computer"),Object(o.b)("p",null,"If you need to build an app with large assets, such as large embedded videos, a simple and practical solution is to use the bare workflow and compile the app using Android Studio and Xcode. You can either use your own computer or provision Linux and macOS VMs with a cloud provider on which to run the standard build toolchains for Android and iOS."),Object(o.b)("p",null,"With ",Object(o.b)("inlineCode",{parentName:"p"},"expo-updates")," you can also host updates on your own servers, which may support arbitrarily large files."),Object(o.b)("h2",{id:"self-hosting-your-updates"},"Self-hosting your updates"),Object(o.b)("p",null,"In addition to building your app on your own computer, you can host your updates on your own servers. Read more about ",Object(o.b)("a",{parentName:"p",href:"/../../../../../../distribution/hosting-your-app"},"Hosting Updates on Your Servers"),"."),Object(o.b)("h2",{id:"a-glimpse-at-the-future"},"A glimpse at the future"),Object(o.b)("p",null,"The next generation of services for Expo apps, Expo Application Services (EAS), will support higher limits and a scalable pricing model for startups and other businesses with those needs. This is a long-term engineering project and we hope to have more to share sometime in 2021."))}l.isMDXComponent=!0},dhJC:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}n.d(t,"a",(function(){return a}))}},[["5hA/",1,0]]]);