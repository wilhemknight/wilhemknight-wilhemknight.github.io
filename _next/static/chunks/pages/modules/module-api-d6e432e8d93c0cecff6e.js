_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[186],{"5JjJ":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/modules/module-api",function(){return n("BC6v")}])},"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return m}));var a=n("q1tI"),o=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var b=o.a.createContext({}),p=function(e){var t=o.a.useContext(b),n=t;return e&&(n="function"===typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=p(e.components);return o.a.createElement(b.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},u=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,r=e.parentName,b=c(e,["components","mdxType","originalType","parentName"]),s=p(n),u=a,m=s["".concat(r,".").concat(u)]||s[u]||d[u]||i;return n?o.a.createElement(m,l(l({ref:t},b),{},{components:n})):o.a.createElement(m,l({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"===typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"===typeof e?e:a,r[1]=l;for(var b=2;b<i;b++)r[b]=n[b];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},BC6v:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return c})),n.d(t,"headings",(function(){return b})),n.d(t,"default",(function(){return s}));var a=n("HALo"),o=n("dhJC"),i=(n("q1tI"),n("7ljp")),r=n("a1/Y"),l=["components"],c={title:"Module API"},b=[{depth:2,type:"text",title:"Design considerations"},{depth:3,type:"text",title:"Why Swift and Kotlin?"},{depth:3,type:"text",title:"Passing data between runtimes"},{depth:2,type:"text",title:"Get Started"},{depth:3,type:"text",title:"1. Set up the library as an Expo module"},{depth:3,type:"text",title:"2. Set up module config"},{depth:3,type:"text",title:"3. Ensure the module is linked"},{depth:2,type:"text",title:"Definition Components"},{depth:3,type:"inlineCode",title:"name"},{depth:3,type:"inlineCode",title:"constants"},{depth:3,type:"inlineCode",title:"function"},{depth:4,type:"text",title:"Arguments"},{depth:3,type:"inlineCode",title:"events"},{depth:3,type:"inlineCode",title:"view"},{depth:3,type:"inlineCode",title:"prop"},{depth:4,type:"text",title:"Arguments"},{depth:3,type:"inlineCode",title:"viewManager"},{depth:3,type:"inlineCode",title:"onCreate"},{depth:3,type:"inlineCode",title:"onDestroy"},{depth:3,type:"inlineCode",title:"onStartObserving"},{depth:3,type:"inlineCode",title:"onStopObserving"},{depth:3,type:"inlineCode",title:"onAppContextDestroys"},{depth:3,type:"inlineCode",title:"onAppEntersForeground  \ud83c\udf4f"},{depth:3,type:"inlineCode",title:"onAppEntersBackground  \ud83c\udf4f"},{depth:3,type:"inlineCode",title:"onAppBecomesActive  \ud83c\udf4f"},{depth:3,type:"inlineCode",title:"onActivityEntersForeground  \ud83e\udd16"},{depth:3,type:"inlineCode",title:"onActivityEntersBackground  \ud83e\udd16"},{depth:3,type:"inlineCode",title:"onActivityDestroys  \ud83e\udd16"},{depth:2,type:"text",title:"Argument Types"},{depth:3,type:"text",title:"Convertibles"},{depth:3,type:"text",title:"Records"},{depth:3,type:"text",title:"Enums"},{depth:2,type:"text",title:"Examples"}],p={meta:c,headings:b};function s(e){var t=e.components,n=Object(o.a)(e,l);return Object(i.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note: This API is still experimental and subject to change. Some features that you need may not be implemented yet.")),Object(i.b)("p",null,"The Expo module API provided by ",Object(i.b)("inlineCode",{parentName:"p"},"expo-modules-core")," is an abstraction layer on top of React Native modules that helps you build native modules in modern languages (Swift and Kotlin) with an easy to use and convenient API that is consistent across platforms where possible."),Object(i.b)("h2",{id:"design-considerations"},"Design considerations"),Object(i.b)("h3",{id:"why-swift-and-kotlin"},"Why Swift and Kotlin?"),Object(i.b)("p",null,"After several years of maintaining over 50 native modules in the Expo SDK, we have found out that many issues that have arisen were caused by unhandled null values or using incorrect types. Modern language features can help developers avoid these bugs; for example, the lack of optional types combined with the dynamism of Objective-C made it tough to catch certain classes of bugs that would have been caught by the compiler in Swift."),Object(i.b)("p",null,"This is one of the reasons why the Expo module ecosystem was designed from the ground up to be used with modern native languages: Swift and Kotlin."),Object(i.b)("h3",{id:"passing-data-between-runtimes"},"Passing data between runtimes"),Object(i.b)("p",null,"Another big pain point that we have encountered is the validation of arguments passed from JavaScript to native functions. This is especially error prone, time consuming, and difficult to maintain when it comes to ",Object(i.b)("inlineCode",{parentName:"p"},"NSDictionary")," or ",Object(i.b)("inlineCode",{parentName:"p"},"ReadableMap"),", where the type of values is unknown in runtime and each property needs to be validated separately by the developer. A valuable feature of the Expo module API is that it has full knowledge of the argument types the native function expects, so it can pre-validate and convert the arguments for you! The dictionaries can be represented as native structs that we call ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#records"},"Records"),". Knowing the argument types, it is also possible to ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#convertibles"},"automatically convert arguments")," to some platform-specific types (e.g. ",Object(i.b)("inlineCode",{parentName:"p"},"{ x: number, y: number }")," or ",Object(i.b)("inlineCode",{parentName:"p"},"[number, number]")," can be translated to CoreGraphics's ",Object(i.b)("inlineCode",{parentName:"p"},"CGPoint")," for your convenience)."),Object(i.b)("h2",{id:"get-started"},"Get Started"),Object(i.b)("h3",{id:"1-set-up-the-library-as-an-expo-module"},"1. Set up the library as an Expo module"),Object(i.b)("p",null,"To use the Expo module API, you need ",Object(i.b)("a",{parentName:"p",href:"/modules/overview"},"set up your library as an Expo module"),". Once that is complete, create Swift and Kotlin files from the below templates."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"import ExpoModulesCore\n\npublic class MyModule: Module {\n  public func definition() -> ModuleDefinition {\n    // Definition components go here\n  }\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},"package my.module.package\n\nimport expo.modules.kotlin.modules.Module\nimport expo.modules.kotlin.modules.ModuleDefinition\n\nclass MyModule : Module() {\n  override fun definition() = ModuleDefinition {\n    // Definition components go here\n  }\n}\n"))),Object(i.b)("h3",{id:"2-set-up-module-config"},"2. Set up module config"),Object(i.b)("p",null,"Add your classes to iOS and/or Android ",Object(i.b)("inlineCode",{parentName:"p"},"modulesClassNames")," in the ",Object(i.b)("a",{parentName:"p",href:"/modules/module-config"},"module config"),"."),Object(i.b)(r.a,{tabs:["expo-module.config.json"],mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "ios": {\n    "modulesClassNames": ["MyModule"]\n  },\n  "android": {\n    "modulesClassNames": ["my.module.package.MyModule"]\n  }\n}\n'))),Object(i.b)("h3",{id:"3-ensure-the-module-is-linked"},"3. Ensure the module is linked"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"On iOS")," you also need to run ",Object(i.b)("inlineCode",{parentName:"p"},"pod install")," to link the new class."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"On Android")," it will be linked automatically before building."),Object(i.b)("p",null,"Now that the class is set up and linked, you can start to add functionality. The rest of this guide is a reference for the module API, along with links to ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#examples"},"examples")," of simple to moderately complex real-world modules that you can reference to better understand how to use the API."),Object(i.b)("h2",{id:"definition-components"},"Definition Components"),Object(i.b)("p",null,"As you might have noticed in the snippets above, each module class must implement the ",Object(i.b)("inlineCode",{parentName:"p"},"definition")," function. The definition consists of components that describe the module's functionality and behavior."),Object(i.b)("h3",{id:"name"},Object(i.b)("inlineCode",{parentName:"h3"},"name")),Object(i.b)("p",null,"Sets the name of the module that JavaScript code will use to refer to the module. Takes a string as an argument. Can be inferred from module's class name, but it's recommended to set it explicitly for clarity."),Object(i.b)(r.a,{tabs:["Swift / Kotlin"],mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},'name("MyModuleName")\n'))),Object(i.b)("h3",{id:"constants"},Object(i.b)("inlineCode",{parentName:"h3"},"constants")),Object(i.b)("p",null,"Sets constant properties on the module. Can take a dictionary or a closure that returns a dictionary."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},'// Created from the dictionary\nconstants([\n  "PI": Double.pi\n])\n\n// or returned by the closure\nconstants {\n  return [\n    "PI": Double.pi\n  ]\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},'// Passed as arguments\nconstants(\n  "PI" to kotlin.math.PI\n)\n\n// or returned by the closure\nconstants {\n  return@constants mapOf(\n    "PI" to kotlin.math.PI\n  )\n}\n'))),Object(i.b)("h3",{id:"function"},Object(i.b)("inlineCode",{parentName:"h3"},"function")),Object(i.b)("p",null,"Defines a native function that will be exported to JavaScript."),Object(i.b)("h4",{id:"arguments"},"Arguments"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"name"),": ",Object(i.b)("inlineCode",{parentName:"li"},"String")," \u2014 Name of the function that you'll call from JavaScript."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"body"),": ",Object(i.b)("inlineCode",{parentName:"li"},"(args...) -> ReturnType")," \u2014 The closure to run when the function is called.")),Object(i.b)("p",null,"All functions return a ",Object(i.b)("inlineCode",{parentName:"p"},"Promise")," to JavaScript and are asynchronous from the perspective of the JavaScript runtime. However, if the type of the last argument is ",Object(i.b)("inlineCode",{parentName:"p"},"Promise"),", the function is considered to be asynchronous on the native side and it will wait for the promise to be resolved or rejected before the response is passed back to JavaScript. Otherwise, the function is immediately resolved with the returned value or rejected if it throws an error. Note that this is different than synchronous/asynchronous calls in JavaScript \u2014 at this moment all functions are ",Object(i.b)("em",{parentName:"p"},"asynchronous")," from the JavaScript perspective."),Object(i.b)("p",null,"The function can receive up to 8 arguments (including the promise). This is due to the limitations of generics in both Swift and Kotlin, because this component must be implemented separately for each number of arguments."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},'function("syncFunction") { (message: String) in\n  return message\n}\n\nfunction("asyncFunction") { (message: String, promise: Promise) in\n  DispatchQueue.main.asyncAfter(deadline: .now() + 3.0) {\n    promise.resolve(message)\n  }\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},'function("syncFunction") { message: String ->\n  return@function message\n}\n\nfunction("asyncFunction") { message: String, promise: Promise ->\n  launch(Dispatchers.Main) {\n    promise.resolve(message)\n  }\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"import { NativeModulesProxy } from 'expo-modules-core';\n\n// Assume that we have named the module \"MyModule\"\nconst { MyModule } = NativeModulesProxy;\n\nasync function getMessage() {\n  // Functions that are synchronous on the native side are still asynchronous to\n  // JavaScript and return a promise\n  const message = await MyModule.syncFunction('foo');\n  const otherMessage = await MyModule.asyncFunction('bar');\n  console.log(`${message} ${otherMessage}); // foo bar\n}\n"))),Object(i.b)("h3",{id:"events"},Object(i.b)("inlineCode",{parentName:"h3"},"events")),Object(i.b)("p",null,"Defines event names that the module can send to JavaScript."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},'events("onCameraReady", "onPictureSaved", "onBarCodeScanned")\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},'events("onCameraReady", "onPictureSaved", "onBarCodeScanned")\n'))),Object(i.b)("h3",{id:"view"},Object(i.b)("inlineCode",{parentName:"h3"},"view")),Object(i.b)("p",null,"Defines the factory creating a native view, when the module is used as a view.\nOn Android, the factory function also receives ",Object(i.b)("a",{parentName:"p",href:"https://developer.android.com/reference/android/content/Context"},"Android Context")," which is required to create any view."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"view {\n  UITextView()\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},"view { context ->\n  TextView(context)\n}\n"))),Object(i.b)("h3",{id:"prop"},Object(i.b)("inlineCode",{parentName:"h3"},"prop")),Object(i.b)("p",null,"Defines a setter for the view prop of given name."),Object(i.b)("h4",{id:"arguments-1"},"Arguments"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"name"),": ",Object(i.b)("inlineCode",{parentName:"li"},"String")," \u2014 Name of view prop that you want to define a setter."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"setter"),": ",Object(i.b)("inlineCode",{parentName:"li"},"(view: ViewType, value: ValueType) -> ()")," \u2014 Closure that is invoked when the view rerenders.")),Object(i.b)("p",null,"This property can only be used within a ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#viewmanager"},Object(i.b)("inlineCode",{parentName:"a"},"viewManager"))," closure."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},'prop("background") { (view: UIView, color: UIColor) in\n  view.backgroundColor = color\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},'prop("background") { view: View, @ColorInt color: Int ->\n  view.setBackgroundColor(color)\n}\n'))),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note: Props of function type (callbacks) are not supported yet.")),Object(i.b)("h3",{id:"viewmanager"},Object(i.b)("inlineCode",{parentName:"h3"},"viewManager")),Object(i.b)("p",null,"Enables the module to be used as a view manager. The view manager definition is built from the definition components used in the closure passed to ",Object(i.b)("inlineCode",{parentName:"p"},"viewManager"),". Definition components that are accepted as part of the view manager definition: ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#view"},Object(i.b)("inlineCode",{parentName:"a"},"view")),", ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#prop"},Object(i.b)("inlineCode",{parentName:"a"},"prop")),"."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},'viewManager {\n  view {\n    UIView()\n  }\n\n  prop("isHidden") { (view: UIView, hidden: Bool) in\n    view.isHidden = hidden\n  }\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},'viewManager {\n  view { context ->\n    View(context)\n  }\n\n  prop("isHidden") { view: View, hidden: Bool ->\n    view.isVisible = !hidden\n  }\n}\n'))),Object(i.b)("h3",{id:"oncreate"},Object(i.b)("inlineCode",{parentName:"h3"},"onCreate")),Object(i.b)("p",null,"Defines module's lifecycle listener that is called right after module initialization. If you need to set up something when the module gets initialized, use this instead of module's class initializer."),Object(i.b)("h3",{id:"ondestroy"},Object(i.b)("inlineCode",{parentName:"h3"},"onDestroy")),Object(i.b)("p",null,"Defines module's lifecycle listener that is called when the module is about to be deallocated. Use it instead of module's class destructor."),Object(i.b)("h3",{id:"onstartobserving"},Object(i.b)("inlineCode",{parentName:"h3"},"onStartObserving")),Object(i.b)("p",null,"Defines the function that is invoked when the first event listener is added."),Object(i.b)("h3",{id:"onstopobserving"},Object(i.b)("inlineCode",{parentName:"h3"},"onStopObserving")),Object(i.b)("p",null,"Defines the function that is invoked when all event listeners are removed."),Object(i.b)("h3",{id:"onappcontextdestroys"},Object(i.b)("inlineCode",{parentName:"h3"},"onAppContextDestroys")),Object(i.b)("p",null,"Defines module's lifecycle listener that is called when the app context owning the module is about to be deallocated."),Object(i.b)("h3",{id:"onappentersforeground-"},Object(i.b)("inlineCode",{parentName:"h3"},"onAppEntersForeground")," \ud83c\udf4f"),Object(i.b)("p",null,"Defines the listener that is called when the app is about to enter the foreground mode."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note: This function is not available on Android \u2014 you may want to use ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#onactivityentersforeground--"},Object(i.b)("inlineCode",{parentName:"a"},"onActivityEntersForeground"))," instead.")),Object(i.b)("h3",{id:"onappentersbackground-"},Object(i.b)("inlineCode",{parentName:"h3"},"onAppEntersBackground")," \ud83c\udf4f"),Object(i.b)("p",null,"Defines the listener that is called when the app enters the background mode."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note: This function is not available on Android \u2014 you may want to use ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#onactivityentersbackground--"},Object(i.b)("inlineCode",{parentName:"a"},"onActivityEntersBackground"))," instead.")),Object(i.b)("h3",{id:"onappbecomesactive-"},Object(i.b)("inlineCode",{parentName:"h3"},"onAppBecomesActive")," \ud83c\udf4f"),Object(i.b)("p",null,"Defines the listener that is called when the app becomes active again (after ",Object(i.b)("inlineCode",{parentName:"p"},"onAppEntersForeground"),")."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note: This function is not available on Android \u2014 you may want to use ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#onactivityentersforeground--"},Object(i.b)("inlineCode",{parentName:"a"},"onActivityEntersForeground"))," instead.")),Object(i.b)("h3",{id:"onactivityentersforeground-"},Object(i.b)("inlineCode",{parentName:"h3"},"onActivityEntersForeground")," \ud83e\udd16"),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note: This function is not available on iOS \u2014 you may want to use ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#onappentersforeground--"},Object(i.b)("inlineCode",{parentName:"a"},"onAppEntersForeground"))," instead.")),Object(i.b)("h3",{id:"onactivityentersbackground-"},Object(i.b)("inlineCode",{parentName:"h3"},"onActivityEntersBackground")," \ud83e\udd16"),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note: This function is not available on iOS \u2014 you may want to use ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#onappentersbackground--"},Object(i.b)("inlineCode",{parentName:"a"},"onAppEntersBackground"))," instead.")),Object(i.b)("h3",{id:"onactivitydestroys-"},Object(i.b)("inlineCode",{parentName:"h3"},"onActivityDestroys")," \ud83e\udd16"),Object(i.b)("p",null,"Defines the listener that is called when the activity owning the JavaScript context is about to be destroyed."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note: This function is not available on iOS \u2014 you may want to use ",Object(i.b)("a",{parentName:"p",href:"/modules/module-api/#onappentersbackground--"},Object(i.b)("inlineCode",{parentName:"a"},"onAppEntersBackground"))," instead.")),Object(i.b)("h2",{id:"argument-types"},"Argument Types"),Object(i.b)("p",null,"Fundamentally, only primitive and serializable data can be passed back and forth between the runtimes. However, usually native modules need to receive custom data structures \u2014 more sophisticated than just the dictionary/map where the values are of unknown (",Object(i.b)("inlineCode",{parentName:"p"},"Any"),") type and so each value has to be validated and casted on its own. The Expo module API provides protocols to make it more convenient to work with data objects, to provide automatic validation, and finally, to ensure native type-safety on each object member."),Object(i.b)("h3",{id:"convertibles"},"Convertibles"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Convertibles")," are native types that can be initialized from certain specific kinds of data received from JavaScript. Such types are allowed to be used as an argument type in ",Object(i.b)("inlineCode",{parentName:"p"},"function"),"'s body. As a good example, when the ",Object(i.b)("inlineCode",{parentName:"p"},"CGPoint")," type is used as a function argument type, its instance can be created from an array of two numbers (",Object(i.b)("em",{parentName:"p"},"x"),", ",Object(i.b)("em",{parentName:"p"},"y"),") or a JavaScript object with numeric ",Object(i.b)("inlineCode",{parentName:"p"},"x")," and ",Object(i.b)("inlineCode",{parentName:"p"},"y")," properties."),Object(i.b)("p",null,"Some common iOS types from ",Object(i.b)("inlineCode",{parentName:"p"},"CoreGraphics")," and ",Object(i.b)("inlineCode",{parentName:"p"},"UIKit")," system frameworks are already made convertible."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Native Type"),Object(i.b)("th",{parentName:"tr",align:null},"TypeScript"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"URL")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"string")," with a URL. When scheme is not provided, it's assumed to be a file URL.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"CGFloat")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"number"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"CGPoint")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"{ x: number, y: number }")," or ",Object(i.b)("inlineCode",{parentName:"td"},"number[]")," with ",Object(i.b)("em",{parentName:"td"},"x")," and ",Object(i.b)("em",{parentName:"td"},"y")," coords")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"CGSize")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"{ width: number, height: number }")," or ",Object(i.b)("inlineCode",{parentName:"td"},"number[]")," with ",Object(i.b)("em",{parentName:"td"},"width")," and ",Object(i.b)("em",{parentName:"td"},"height"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"CGVector")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"{ dx: number, dy: number }")," or ",Object(i.b)("inlineCode",{parentName:"td"},"number[]")," with ",Object(i.b)("em",{parentName:"td"},"dx")," and ",Object(i.b)("em",{parentName:"td"},"dy")," vector differentials")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"CGRect")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"{ x: number, y: number, width: number, height: number }")," or ",Object(i.b)("inlineCode",{parentName:"td"},"number[]")," with ",Object(i.b)("em",{parentName:"td"},"x"),", ",Object(i.b)("em",{parentName:"td"},"y"),", ",Object(i.b)("em",{parentName:"td"},"width")," and ",Object(i.b)("em",{parentName:"td"},"height")," values")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"CGColor")),Object(i.b)("td",{parentName:"tr",align:null},"Color hex strings in formats: ",Object(i.b)("inlineCode",{parentName:"td"},"#RRGGBB"),", ",Object(i.b)("inlineCode",{parentName:"td"},"#RRGGBBAA"),", ",Object(i.b)("inlineCode",{parentName:"td"},"#RGB"),", ",Object(i.b)("inlineCode",{parentName:"td"},"#RGBA"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"UIColor")),Object(i.b)("td",{parentName:"tr",align:null},"Color hex strings in formats: ",Object(i.b)("inlineCode",{parentName:"td"},"#RRGGBB"),", ",Object(i.b)("inlineCode",{parentName:"td"},"#RRGGBBAA"),", ",Object(i.b)("inlineCode",{parentName:"td"},"#RGB"),", ",Object(i.b)("inlineCode",{parentName:"td"},"#RGBA"))))),Object(i.b)("h3",{id:"records"},"Records"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Record")," is a convertible type and an equivalent of the dictionary (Swift) or map (Kotlin), but represented as a struct where each field can have its own type and provide a default value."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},'struct FileReadOptions: Record {\n  @Field\n  var encoding: String = "utf8"\n\n  @Field\n  var position: Int = 0\n\n  @Field\n  var length: Int?\n}\n\n// Now this record can be used as an argument of the functions or the view prop setters.\nfunction("readFile") { (path: String, options: FileReadOptions) -> String in\n  // Read the file using given `options`\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},'class FileReadOptions : Record {\n  @Field\n  val encoding: String = "utf8"\n\n  @Field\n  val position: Int = 0\n\n  @Field\n  val length: Int?\n}\n\n// Now this record can be used as an argument of the functions or the view prop setters.\nfunction("readFile") { path: String, options: FileReadOptions ->\n  // Read the file using given `options`\n}\n'))),Object(i.b)("h3",{id:"enums"},"Enums"),Object(i.b)("p",null,"With enums we can go even further with the above example (with ",Object(i.b)("inlineCode",{parentName:"p"},"FileReadOptions")," record) and limit supported encodings to ",Object(i.b)("inlineCode",{parentName:"p"},'"utf8"')," and ",Object(i.b)("inlineCode",{parentName:"p"},'"base64"'),". To use an enum as an argument or record field, it must represent a primitive value (e.g. ",Object(i.b)("inlineCode",{parentName:"p"},"String"),", ",Object(i.b)("inlineCode",{parentName:"p"},"Int"),") and conform to ",Object(i.b)("inlineCode",{parentName:"p"},"EnumArgument"),"."),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},"enum FileEncoding: String, EnumArgument {\n  case utf8\n  case base64\n}\n\nstruct FileReadOptions: Record {\n  @Field\n  var encoding: FileEncoding = .utf8\n  // ...\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},'// Note: the constructor must have an argument called value.\nenum class FileEncoding(val value: String) {\n  utf8("utf8"),\n  base64("base64")\n}\n\nclass FileReadOptions : Record {\n  @Field\n  val encoding: FileEncoding = FileEncoding.utf8\n  // ...\n}\n'))),Object(i.b)("h2",{id:"examples"},"Examples"),Object(i.b)(r.a,{mdxType:"CodeBlocksTable"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-swift"},'public class MyModule: Module {\n  public func definition() -> ModuleDefinition {\n    name("MyFirstExpoModule")\n\n    function("hello") { (name: String) in\n      return "Hello \\(name)!"\n    }\n  }\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-kotlin"},'class MyModule : Module() {\n  override fun definition() = ModuleDefinition {\n    name("MyFirstExpoModule")\n\n    function("hello") { name: String ->\n      return "Hello $name!"\n    }\n  }\n}\n'))),Object(i.b)("p",null,"For more examples from real modules, you can refer to Expo modules that already use this API on GitHub:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"expo-cellular")," (",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-cellular/ios/CellularModule.swift"},"Swift"),", ",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-cellular/android/src/main/java/expo/modules/cellular/CellularModule.kt"},"Kotlin"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"expo-linear-gradient")," (",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-linear-gradient/ios/LinearGradientModule.swift"},"Swift"),", ",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-linear-gradient/android/src/main/java/expo/modules/lineargradient/LinearGradientModule.kt"},"Kotlin"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"expo-haptics")," (",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-haptics/ios/HapticsModule.swift"},"Swift"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"expo-clipboard")," (",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-clipboard/ios/ClipboardModule.swift"},"Swift"),", ",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-clipboard/android/src/main/java/expo/modules/clipboard/ClipboardModule.kt"},"Kotlin"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"expo-localization")," (",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-localization/ios/LocalizationModule.swift"},"Swift"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"expo-system-ui")," (",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-system-ui/ios/ExpoSystemUI/ExpoSystemUIModule.swift"},"Swift"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"expo-image-manipulator")," (",Object(i.b)("a",{parentName:"li",href:"https://github.com/expo/expo/tree/main/packages/expo-image-manipulator/ios/ImageManipulatorModule.swift"},"Swift"),")")))}s.isMDXComponent=!0},"a1/Y":function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("AeFk"),o=n("3zh3"),i=(n("q1tI"),{"language-swift":"Swift","language-kotlin":"Kotlin","language-javascript":"JavaScript","language-typescript":"TypeScript","language-json":"JSON","language-ruby":"Ruby","language-groovy":"Gradle"}),r=Object(a.b)("display:flex;flex-direction:row;max-width:100%;margin:20px 0px;.code-block-column{display:flex;flex-direction:column;flex:1;margin-right:-1px;min-width:0px;pre{border-top-left-radius:0px;border-top-right-radius:0px;}&:not(:first-child) pre{border-bottom-left-radius:0px;}&:not(:last-child) pre{border-bottom-right-radius:0px;}&:first-child .code-block-header{border-top-left-radius:4px;}&:last-child .code-block-header{border-top-right-radius:4px;}}.code-block-header{padding:6px 16px;background-color:",o.theme.background.secondary,";border:1px solid ",o.theme.border.default,";border-bottom-width:0px;span{color:",o.theme.text.default,";font-family:",o.typography.fontFaces.mono,";font-size:15px;}}.code-block-content{flex:1;overflow-x:scroll;pre{height:100%;margin:0px;}}","");function l(e){var t=e.children,n=e.tabs,o=(Array.isArray(t)?t:[t]).filter((function(e){var t=e.props;return"pre"===t.mdxType&&t.children.props.className})),l=n||o.map((function(e){var t=e.props.children.props.className;return i[t]||t.replace("language-","")}));return Object(a.c)("div",{css:r},o.map((function(e,t){return Object(a.c)("div",{key:t,className:"code-block-column"},Object(a.c)("div",{className:"code-block-header"},Object(a.c)("span",null,l[t])),Object(a.c)("div",{className:"code-block-content"},e))})))}}},[["5JjJ",1,0,2,3]]]);