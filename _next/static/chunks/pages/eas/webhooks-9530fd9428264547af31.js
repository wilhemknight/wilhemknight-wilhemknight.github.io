_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[123],{"+Css":function(e,t,n){"use strict";function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return o}))},"2dLa":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/eas/webhooks",function(){return n("DHIz")}])},"7LId":function(e,t,n){"use strict";function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}n.d(t,"a",(function(){return r}))},"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return f}));var o=n("q1tI"),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),u=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"===typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=u(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),b=u(n),d=o,f=b["".concat(i,".").concat(d)]||b[d]||p[d]||a;return n?r.a.createElement(f,s(s({ref:t},l),{},{components:n})):r.a.createElement(f,s({ref:t},l))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"===typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"===typeof e?e:o,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},"C+bE":function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},DHIz:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return c})),n.d(t,"headings",(function(){return l})),n.d(t,"default",(function(){return b}));var o=n("HALo"),r=n("dhJC"),a=(n("q1tI"),n("7ljp")),i=n("3WCi"),s=["components"],c={title:"Webhooks"},l=[{depth:2,type:"text",title:"Webhook payload"},{depth:2,type:"text",title:"Webhook server"}],u={meta:c,headings:l};function b(e){var t=e.components,n=Object(r.a)(e,s);return Object(a.b)("wrapper",Object(o.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"EAS can alert you as soon as your build or submission has completed via a webhook. Webhooks need to be configured per-project, so if you want to be alerted for both ",Object(a.b)("inlineCode",{parentName:"p"},"@johndoe/awesomeApp")," and ",Object(a.b)("inlineCode",{parentName:"p"},"@johndoe/coolApp"),", you need to run ",Object(a.b)("inlineCode",{parentName:"p"},"eas webhook:create")," in each directory."),Object(a.b)("details",null,Object(a.b)("summary",null,Object(a.b)("strong",null,"Are you using the classic build system?")," (",Object(a.b)(i.b,{mdxType:"InlineCode"},"expo build:[android|ios]"),")")," ",Object(a.b)("p",null,Object(a.b)("p",null,"Webhooks function almost exactly the same for both EAS Build and the classic ",Object(a.b)("inlineCode",{parentName:"p"},"expo build")," system, ",Object(a.b)("em",{parentName:"p"},"except")," that for ",Object(a.b)("inlineCode",{parentName:"p"},"expo build")," webhooks, you'll use ",Object(a.b)("inlineCode",{parentName:"p"},"expo-cli")," to interact with them, and ",Object(a.b)("strong",{parentName:"p"},"not")," ",Object(a.b)("inlineCode",{parentName:"p"},"eas-cli"),". For ",Object(a.b)("inlineCode",{parentName:"p"},"expo build")," webhooks, you'll use:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"expo webhooks [path]"),": List all webhooks for a project"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"expo webhooks:add [path]"),": Add a webhook to a project"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"expo webhooks:remove [path]"),": Delete a webhook"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"expo webhooks:update [path]"),": Update an existing webhook")))),Object(a.b)("p",null,"After running ",Object(a.b)("inlineCode",{parentName:"p"},"eas webhook:create"),", you'll be prompted to choose the webhook event type (unless you provide the ",Object(a.b)("inlineCode",{parentName:"p"},"--event BUILD|SUBMIT")," parameter). Next, provide the webhook URL (or specify it with the ",Object(a.b)("inlineCode",{parentName:"p"},"--url")," flag) that handles HTTP POST requests. Additionally, you'll have to input a webhook signing secret, if you have not already provided it with the ",Object(a.b)("inlineCode",{parentName:"p"},"--secret")," flag. It must be at least 16 characters long, and it will be used to calculate the signature of the request body which we send as the value of the ",Object(a.b)("inlineCode",{parentName:"p"},"expo-signature")," HTTP header. You can use the signature to verify a webhook request is genuine (example code below)."),Object(a.b)("p",null,"EAS calls your webhook using an HTTP POST request. All the data is passed in the request body. EAS sends the data as a JSON object."),Object(a.b)("p",null,"Additionally, we send an ",Object(a.b)("inlineCode",{parentName:"p"},"expo-signature")," HTTP header with the hash signature of the payload. You can use this signature to verify the authenticity of the request. The signature is a hex-encoded HMAC-SHA1 digest of the request body, using your webhook secret as the HMAC key."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"If you want to test the above webhook locally, you have to use a service like ",Object(a.b)("a",{parentName:"p",href:"https://ngrok.com/docs"},"ngrok")," to forward ",Object(a.b)("inlineCode",{parentName:"p"},"localhost:8080")," via a tunnel and make it publicly accessible with the URL ",Object(a.b)("inlineCode",{parentName:"p"},"ngrok")," gives you.")),Object(a.b)("p",null,"You can always change your webhook URL and/or webhook secret using ",Object(a.b)("inlineCode",{parentName:"p"},"eas webhook:update --id WEBHOOK_ID"),". You can find the webhook ID by running ",Object(a.b)("inlineCode",{parentName:"p"},"eas webhook:list"),". If you would like us to stop sending requests to your webhook, run ",Object(a.b)("inlineCode",{parentName:"p"},"eas webhook:delete")," and choose the webhook from the list."),Object(a.b)("h2",{id:"webhook-payload"},"Webhook payload"),Object(a.b)("details",null,Object(a.b)("summary",null,Object(a.b)("strong",null,"Build webhook payload")),Object(a.b)("p",null,Object(a.b)("p",null,"The build webhook payload looks something like this:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "147a3212-49fd-446f-b4e3-a6519acf264a",\n  "appId": "bc0a82de-65a5-4497-ad86-54ff1f53edf7",\n  "initiatingUserId": "d1041496-1a59-423a-8caf-479bb978203a",\n  "cancelingUserId": null, // available for canceled builds\n  "platform": "android", // or "ios"\n  "status": "errored", // or: "finished", "canceled"\n  "artifacts": {\n    "buildUrl": "https://expo.dev/artifacts/eas/wyodu9tua2ZuKKiaJ1Nbkn.aab", // available for successful builds\n    "logsS3KeyPrefix": "production/f9609423-5072-4ea2-a0a5-c345eedf2c2a"\n  },\n  "metadata": {\n    "appName": "example",\n    "username": "dsokal",\n    "workflow": "managed",\n    "appVersion": "1.0.2",\n    "cliVersion": "0.37.0",\n    "sdkVersion": "41.0.0",\n    "buildProfile": "production",\n    "distribution": "store",\n    "appIdentifier": "com.expo.example",\n    "gitCommitHash": "564b61ebdd403d28b5dc616a12ce160b91585b5b",\n    "releaseChannel": "default",\n    "appBuildVersion": "6",\n    "trackingContext": {\n      "platform": "android",\n      "account_id": "7c34cbf1-efd4-4964-84a1-c13ed297aaf9",\n      "dev_client": false,\n      "project_id": "bc0a82de-65a5-4497-ad86-54ff1f53edf7",\n      "tracking_id": "a3fdefa7-d129-42f2-9432-912050ab0f10",\n      "account_name": "dsokal",\n      "project_type": "managed",\n      "dev_client_version": "0.6.2"\n    },\n    "credentialsSource": "remote",\n    "isGitWorkingTreeDirty": false\n  },\n  "metrics": {\n    "memory": 895070208,\n    "buildEndTimestamp": 1637747861168,\n    "totalDiskReadBytes": 692224,\n    "buildStartTimestamp": 1637747834445,\n    "totalDiskWriteBytes": 14409728,\n    "cpuActiveMilliseconds": 12117.540078,\n    "buildEnqueuedTimestamp": 1637747792476,\n    "totalNetworkEgressBytes": 355352,\n    "totalNetworkIngressBytes": 78781667\n  },\n  // available for failed builds\n  "error": {\n    "message": "Unknown error. Please see logs.",\n    "errorCode": "UNKNOWN_ERROR"\n  },\n  "createdAt": "2021-11-24T09:53:01.155Z",\n  "updatedAt": "2021-11-24T09:57:42.715Z",\n  "expirationDate": "2021-12-24T09:53:01.155Z"\n}\n')))),Object(a.b)("details",null,Object(a.b)("summary",null,Object(a.b)("strong",null,"Submit webhook payload")),Object(a.b)("p",null,Object(a.b)("p",null,"The submit webhook payload looks something like this:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "0374430d-7776-44ad-be7d-8513629adc54",\n  "appId": "23c0e405-d282-4399-b280-5689c3e1ea85",\n  "initiatingUserId": "7bee4c21-3eaa-4011-a0fd-3678b6537f47",\n  "turtleBuildId": "8c84111e-6d39-449c-9895-071d85fd3e61", // available when submitting a build from EAS\n  "platform": "android", // or "ios"\n  "status": "errored", // or: "finished", "canceled"\n  "submissionInfo": {\n    // available for failed submissions\n    "error": {\n      "message": "Android version code needs to be updated",\n      "errorCode": "SUBMISSION_SERVICE_ANDROID_OLD_VERSION_CODE_ERROR"\n    },\n    "logsUrl": "https://submission-service-logs.s3-us-west-1.amazonaws.com/production/submission_728aa20b-f7a9-4da7-9b64-39911d427b19.txt"\n  },\n  "createdAt": "2021-11-24T10:15:32.822Z",\n  "updatedAt": "2021-11-24T10:15:32.822Z"\n}\n')))),Object(a.b)("h2",{id:"webhook-server"},"Webhook server"),Object(a.b)("p",null,"Here's an example of how you can implement your server:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"const crypto = require('crypto');\nconst express = require('express');\nconst bodyParser = require('body-parser');\nconst safeCompare = require('safe-compare');\n\nconst app = express();\napp.use(bodyParser.text({ type: '*/*' }));\napp.post('/webhook', (req, res) => {\n  const expoSignature = req.headers['expo-signature'];\n  // process.env.SECRET_WEBHOOK_KEY has to match SECRET value set with `eas webhook:create` command\n  const hmac = crypto.createHmac('sha1', process.env.SECRET_WEBHOOK_KEY);\n  hmac.update(req.body);\n  const hash = `sha1=${hmac.digest('hex')}`;\n  if (!safeCompare(expoSignature, hash)) {\n    res.status(500).send(\"Signatures didn't match!\");\n  } else {\n    // do something here, like send a notification to Slack!\n    // console.log(req.body);\n    res.send('OK!');\n  }\n});\napp.listen(8080, () => console.log('Listening on port 8080'));\n")))}b.isMDXComponent=!0},"H+61":function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return o}))},UlJF:function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}n.d(t,"a",(function(){return r}))},VIvw:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("C+bE"),r=n.n(o),a=n("+Css");function i(e,t){if(t&&("object"===r()(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Object(a.a)(e)}},iHvq:function(e,t,n){"use strict";function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return o}))}},[["2dLa",1,0,2,3,7]]]);