_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[162],{"7dRA":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guides/testing-with-jest",function(){return n("gJEU")}])},"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return j}));var o=n("q1tI"),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=r.a.createContext({}),l=function(e){var t=r.a.useContext(p),n=t;return e&&(n="function"===typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=l(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),b=l(n),d=o,j=b["".concat(s,".").concat(d)]||b[d]||u[d]||a;return n?r.a.createElement(j,i(i({ref:t},p),{},{components:n})):r.a.createElement(j,i({ref:t},p))}));function j(e,t){var n=arguments,o=t&&t.mdxType;if("string"===typeof e||o){var a=n.length,s=new Array(a);s[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"===typeof e?e:o,s[1]=i;for(var p=2;p<a;p++)s[p]=n[p];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},HALo:function(e,t,n){"use strict";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}n.d(t,"a",(function(){return o}))},Qetd:function(e,t,n){"use strict";var o=Object.assign.bind(Object);e.exports=o,e.exports.default=e.exports},dhJC:function(e,t,n){"use strict";function o(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}n.d(t,"a",(function(){return o}))},gJEU:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return i})),n.d(t,"headings",(function(){return c})),n.d(t,"default",(function(){return l}));var o=n("HALo"),r=n("dhJC"),a=(n("q1tI"),n("7ljp")),s=["components"],i={title:"Testing with Jest"},c=[{depth:2,type:"text",title:"Installation"},{depth:2,type:"text",title:"Jest Configuration"},{depth:2,type:"text",title:"Unit Test"},{depth:2,type:"text",title:"Snapshot Test"},{depth:2,type:"text",title:"Code Coverage Reports"},{depth:2,type:"text",title:"Structure your Tests"},{depth:2,type:"text",title:"Jest Flows"}],p={meta:i,headings:c};function l(e){var t=e.components,n=Object(r.a)(e,s);return Object(a.b)("wrapper",Object(o.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"This guide explains how to set up Jest in your project, write a unit test, write a snapshot test, and common problems people encounter when using ",Object(a.b)("strong",{parentName:"p"},"Jest")," in React Native."),Object(a.b)("p",null,Object(a.b)("a",{parentName:"p",href:"https://jestjs.io"},"Jest")," is the most widely used JavaScript unit testing framework, so you may already be familiar with it."),Object(a.b)("h2",{id:"installation"},"Installation"),Object(a.b)("p",null,"The first thing we'll want to do is to install ",Object(a.b)("inlineCode",{parentName:"p"},"jest-expo"),", it's a Jest preset that mocks out the native side of the Expo SDK and handles most of configurations for you."),Object(a.b)("p",null,"To install the compatible version of ",Object(a.b)("inlineCode",{parentName:"p"},"jest-expo")," for your project, run: ",Object(a.b)("inlineCode",{parentName:"p"},"expo install jest-expo jest")),Object(a.b)("p",null,"Then, we need to add/update ",Object(a.b)("strong",{parentName:"p"},"package.json")," to include:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},'"scripts": {\n  ...\n  "test": "jest"\n},\n"jest": {\n  "preset": "jest-expo"\n}\n')),Object(a.b)("p",null,"Now let's add ",Object(a.b)("inlineCode",{parentName:"p"},"react-test-renderer")," to our project. Pick a version that is compatible with the React version used by your project. For example, if you use React 17.x then you should install ",Object(a.b)("inlineCode",{parentName:"p"},"react-test-renderer@17"),":"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"yarn add react-test-renderer@17 --dev")," ",Object(a.b)("strong",{parentName:"p"},"or")," ",Object(a.b)("inlineCode",{parentName:"p"},"npm i react-test-renderer@17 --save-dev")),Object(a.b)("p",null,"That's it! Now we can start writing Jest tests!"),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},Object(a.b)("strong",{parentName:"p"},"Note"),": ",Object(a.b)("a",{parentName:"p",href:"https://github.com/callstack/react-native-testing-library"},"react-native-testing-library")," is a library built on top of react-test-renderer that could be helpful in your workflow, but we won't cover it in this guide.")),Object(a.b)("h2",{id:"jest-configuration"},"Jest Configuration"),Object(a.b)("p",null,"Jest comes with a lot of configuration options, for more details read ",Object(a.b)("a",{parentName:"p",href:"https://jestjs.io/docs/configuration"},"Configuring Jest"),"."),Object(a.b)("p",null,"We would like to point out ",Object(a.b)("a",{parentName:"p",href:"https://jestjs.io/docs/configuration#transformignorepatterns-arraystring"},Object(a.b)("inlineCode",{parentName:"a"},"transformIgnorePatterns")),". Below is a great starting point to make sure any modules you may be using within ",Object(a.b)("inlineCode",{parentName:"p"},"/node_modules/")," are transpiled when running jest. This should cover the majority of your needs but you can always add to this pattern list as you see fit."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'"jest": {\n  "preset": "jest-expo",\n  "transformIgnorePatterns": [\n    "node_modules/(?!((jest-)?react-native|@react-native(-community)?)|expo(nent)?|@expo(nent)?/.*|@expo-google-fonts/.*|react-navigation|@react-navigation/.*|@unimodules/.*|unimodules|sentry-expo|native-base|react-native-svg)"\n  ]\n}\n')),Object(a.b)("h2",{id:"unit-test"},"Unit Test"),Object(a.b)("p",null,"We are going to write a simple test for ",Object(a.b)("strong",{parentName:"p"},"App.js")," by creating it's own test file: ",Object(a.b)("strong",{parentName:"p"},"App.test.js"),". Jest will identify this as a test and include it in the tests queue. There are other ways to ",Object(a.b)("a",{parentName:"p",href:"/guides/testing-with-jest/#structure-your-tests"},"structure your tests"),", but we will cover that later in this guide."),Object(a.b)("p",null,"Our test will be the expected state of the ",Object(a.b)("inlineCode",{parentName:"p"},"<App />")," to have one child element:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},"import React from 'react';\nimport renderer from 'react-test-renderer';\n\nimport App from './App';\n\ndescribe('<App />', () => {\n  it('has 1 child', () => {\n    const tree = renderer.create(<App />).toJSON();\n    expect(tree.children.length).toBe(1);\n  });\n});\n")),Object(a.b)("p",null,"Now run ",Object(a.b)("inlineCode",{parentName:"p"},"yarn test")," or ",Object(a.b)("inlineCode",{parentName:"p"},"npm run test"),", if everything goes well, you should see that one test passed! Read more on ",Object(a.b)("a",{parentName:"p",href:"https://jestjs.io/docs/en/expect"},"expect and conditional matchers"),"."),Object(a.b)("h2",{id:"snapshot-test"},"Snapshot Test"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"What is a snapshot test, and why is it useful?")," Snapshot tests are used to make sure the UI stays consistent, especially when a project is working with global styles that are potentially shared across components. Read more about it on Jest's site ",Object(a.b)("a",{parentName:"p",href:"https://jestjs.io/docs/en/snapshot-testing"},"snapshot testing"),"."),Object(a.b)("p",null,"Now let's add a snapshot test for ",Object(a.b)("strong",{parentName:"p"},"App.js"),", add the following within the ",Object(a.b)("inlineCode",{parentName:"p"},"describe()"),":"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},"it('renders correctly', () => {\n  const tree = renderer.create(<App />).toJSON();\n  expect(tree).toMatchSnapshot();\n});\n")),Object(a.b)("p",null,"Now run ",Object(a.b)("inlineCode",{parentName:"p"},"yarn test")," or ",Object(a.b)("inlineCode",{parentName:"p"},"npm run test"),", if everything goes well, you should see a snapshot created and two tests passed!"),Object(a.b)("p",null,"This was a very simple test, for more information, take a look at the following links:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://jestjs.io/docs/en/api"},"API: Globals")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://jestjs.io/docs/en/mock-function-api"},"API: Mock Functions")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://jestjs.io/docs/en/expect"},"API: Expect")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://jestjs.io/docs/en/cli"},"CLI Options"))),Object(a.b)("h2",{id:"code-coverage-reports"},"Code Coverage Reports"),Object(a.b)("p",null,"Running tests are cool and all, but wouldn't you like to see total code coverage in your Expo projects?! Maybe even see it in an HTML format?! This section is for you!"),Object(a.b)("p",null,"Let's head back to ",Object(a.b)("strong",{parentName:"p"},"package.json")," and add the following:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},'"jest": {\n  ...\n  "collectCoverage": true,\n  "collectCoverageFrom": [\n    "**/*.{js,jsx}",\n    "!**/coverage/**",\n    "!**/node_modules/**",\n    "!**/babel.config.js",\n    "!**/jest.setup.js"\n  ]\n}\n')),Object(a.b)("p",null,"The above additions let Jest know to collect coverage of all ",Object(a.b)("strong",{parentName:"p"},Object(a.b)("em",{parentName:"strong"},".js & .jsx"))," file types and not within ",Object(a.b)("strong",{parentName:"p"},Object(a.b)("em",{parentName:"strong"},"/coverage")),", ",Object(a.b)("strong",{parentName:"p"},Object(a.b)("em",{parentName:"strong"},"/node_modules/"))," and our 2 project config files (add/remove more exclusions to this list to match your needs)."),Object(a.b)("p",null,"Now run the test again, you should see ",Object(a.b)("strong",{parentName:"p"},"/coverage")," in your app directory! Find the ",Object(a.b)("strong",{parentName:"p"},"index.html")," file within and double click to open it up in a browser. Not only do we have reporting in our CLI, we also have an HTML version of our code coverage, pretty cool stuff!"),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},Object(a.b)("strong",{parentName:"p"},"Standards Note"),": You can do what you want, but usually we wouldn't upload this html reporting to git; so add ",Object(a.b)("inlineCode",{parentName:"p"},"coverage/\\*\\*/*")," as a line in ",Object(a.b)("inlineCode",{parentName:"p"},".gitignore")," to prevent this directory from being tracked.")),Object(a.b)("h2",{id:"structure-your-tests"},"Structure your Tests"),Object(a.b)("p",null,"As promised, let's talk about how to set up the tests. Right now we have a single ",Object(a.b)("inlineCode",{parentName:"p"},".test.js")," in the root of our Expo project, this can get messy quickly. The easiest way is to create a ",Object(a.b)("inlineCode",{parentName:"p"},"__tests__")," directory (anywhere you'd like) and put all the tests there. For example see below:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-sh"},"__tests__/\n\u251c\u2500 components/\n\u2502  \u2514\u2500 button.test.js\n\u251c\u2500 navigation/\n\u2502  \u2514\u2500 mainstack.test.js\n\u2514\u2500 screens/\n   \u2514\u2500 home.test.js\nsrc/\n\u251c\u2500 components/\n\u2502  \u2514\u2500 button.js\n\u251c\u2500 navigation/\n\u2502  \u2514\u2500 mainstack.js\n\u2514\u2500 screens/\n   \u2514\u2500 home.js\n")),Object(a.b)("p",null,"This ",Object(a.b)("strong",{parentName:"p"},"could")," cause a lot of long import paths though (",Object(a.b)("inlineCode",{parentName:"p"},"../../src/components/button"),"), so another option would be to have multiple ",Object(a.b)("inlineCode",{parentName:"p"},"__tests__")," directories:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-sh"},"src/\n\u251c\u2500 components/\n\u251c\u2500 __tests__/\n\u2502  \u2502  \u2514\u2500 button.test.js\n\u2502  \u2514\u2500 button.js\n...\n")),Object(a.b)("p",null,"So if we move ",Object(a.b)("inlineCode",{parentName:"p"},"__tests__")," within ",Object(a.b)("inlineCode",{parentName:"p"},"components"),", the ",Object(a.b)("em",{parentName:"p"},"button.test.js")," import of ",Object(a.b)("inlineCode",{parentName:"p"},"<Button />")," would now be: ",Object(a.b)("inlineCode",{parentName:"p"},"../button"),", that's a lot better!"),Object(a.b)("p",null,"Another option for test/file structure:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-sh"},"src/\n\u251c\u2500 components/\n\u2502  \u251c\u2500 button.js\n\u2502  \u251c\u2500 button.style.js\n\u2502  \u2514\u2500 button.test.js\n...\n")),Object(a.b)("p",null,"At the end of the day, it's all about preferences and up to you to know how you'd like to structure things, but we wanted to share a few options to consider."),Object(a.b)("h2",{id:"jest-flows"},"Jest Flows"),Object(a.b)("p",null,"This is optional, but wanted to talk about different Jest test flows. Currently we run the test and that's it, but take a look at the ",Object(a.b)("a",{parentName:"p",href:"https://jestjs.io/docs/en/cli"},"CLI Options"),". Below are a few script setups to try:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},'"scripts": {\n  ...\n  // active development of tests, watch files for changes and re-runs all tests\n  "test": "jest --watch --coverage=false --changedSince=origin/master",\n\n  // debug, console.logs and only re-runs the file that was changed\n  "testDebug": "jest -o --watch --coverage=false",\n\n  // displays code coverage in cli and updates the code coverage html\n  "testFinal": "jest",\n\n  // when a screen/component is updated, the test snapshots will throw an error, this updates them\n  "updateSnapshots": "jest -u --coverage=false"\n}\n')))}l.isMDXComponent=!0}},[["7dRA",1,0]]]);